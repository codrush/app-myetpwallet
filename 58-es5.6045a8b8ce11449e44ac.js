!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{"26X8":function(n,r,o){"use strict";o.r(r),o.d(r,"PassphrasePageModule",(function(){return W}));var i=o("ofXK"),a=o("3Pt+"),s=o("TEn/"),c=o("tyNb"),l=o("mrSG"),b=o("fXoL"),u=o("OaWH"),f=o("sYmb"),p=o("vZMD"),d=o("BZA/"),S=o("Fvwb"),m=o("3LUQ");function h(e,t){1&e&&b.Sb(0,"ion-label",14)}function v(e,t){if(1&e&&(b.Xb(0,"ion-label",15),b.Ic(1),b.kc(2,"translate"),b.kc(3,"uppercase"),b.Wb()),2&e){var n=b.jc(2);b.Fb(1),b.Kc(" ",b.mc(2,1,b.lc(3,4,"SELECT_PASSPHRASE.ERROR."+n.getError(n.form.controls.passphrase)[0]),n.getError(n.form.controls.passphrase)[1])," ")}}function E(e,t){1&e&&b.Sb(0,"ion-label",16)}function g(e,t){if(1&e&&(b.Xb(0,"ion-label",15),b.Ic(1),b.kc(2,"translate"),b.kc(3,"uppercase"),b.Wb()),2&e){var n=b.jc(2);b.Fb(1),b.Kc(" ",b.lc(2,1,b.lc(3,3,"SELECT_PASSPHRASE.ERROR."+n.getError(n.form.controls.repeat,n.form)[0]))," ")}}function w(e,t){if(1&e&&(b.Xb(0,"ion-button",17),b.Sb(1,"ion-icon",18),b.Sb(2,"span",19),b.Wb()),2&e){var n=b.jc(2);b.pc("disabled",!n.form.valid)}}function A(e,t){if(1&e){var n=b.Yb();b.Xb(0,"form",7),b.fc("ngSubmit",(function(){return b.Ac(n),b.jc().downloadAndReturnLogin()})),b.Xb(1,"ion-item"),b.Gc(2,h,1,0,"ion-label",8),b.Gc(3,v,4,6,"ion-label",9),b.Sb(4,"ion-input",10),b.Wb(),b.Xb(5,"ion-item"),b.Gc(6,E,1,0,"ion-label",11),b.Gc(7,g,4,5,"ion-label",9),b.Sb(8,"ion-input",12),b.Wb(),b.Gc(9,w,3,1,"ion-button",13),b.Wb()}if(2&e){var r=b.jc();b.pc("formGroup",r.form),b.Fb(2),b.pc("ngIf",!r.getError(r.form.controls.passphrase)),b.Fb(1),b.pc("ngIf",r.getError(r.form.controls.passphrase)),b.Fb(3),b.pc("ngIf",!r.getError(r.form.controls.repeat,r.form)),b.Fb(1),b.pc("ngIf",r.getError(r.form.controls.repeat,r.form)),b.Fb(2),b.pc("ngIf",!r.isMobile)}}function R(e,t){if(1&e){var n=b.Yb();b.Xb(0,"ion-row"),b.Xb(1,"ion-col",20),b.Xb(2,"ion-button",21),b.fc("click",(function(){return b.Ac(n),b.jc(2).download()})),b.Sb(3,"ion-icon",18),b.Sb(4,"span",19),b.Wb(),b.Wb(),b.Xb(5,"ion-col",20),b.Xb(6,"ion-button",22),b.fc("click",(function(){return b.Ac(n),b.jc(2).encrypt()})),b.Sb(7,"ion-icon",23),b.Sb(8,"span",24),b.Wb(),b.Wb(),b.Wb()}if(2&e){var r=b.jc(2);b.Fb(2),b.pc("disabled",!r.form.valid),b.Fb(4),b.pc("disabled",!r.form.valid)}}function y(e,t){if(1&e){var n=b.Yb();b.Xb(0,"ion-row"),b.Xb(1,"ion-col",25),b.Xb(2,"ion-button",22),b.fc("click",(function(){return b.Ac(n),b.jc(2).encrypt()})),b.Sb(3,"ion-icon",23),b.Sb(4,"span",24),b.Wb(),b.Wb(),b.Wb()}if(2&e){var r=b.jc(2);b.Fb(2),b.pc("disabled",!r.form.valid)}}function P(e,t){if(1&e&&(b.Xb(0,"ion-footer"),b.Gc(1,R,9,2,"ion-row",6),b.Gc(2,y,5,1,"ion-row",6),b.Wb()),2&e){var n=b.jc();b.Fb(1),b.pc("ngIf",!n.isApp),b.Fb(1),b.pc("ngIf",n.isApp)}}var I,L,O,T=[{path:"",component:(I=function(){function n(t,r,o,i,a,s,c,l,b,u){var f=this;e(this,n),this.globals=t,this.translate=r,this.crypto=o,this.platform=i,this.metaverseService=a,this.loadingCtrl=s,this.walletService=c,this.formBuilder=l,this.router=b,this.alertService=u,this.mnemonic=history.state.data&&history.state.data.mnemonic?history.state.data.mnemonic:"",this.passwordValid=function(e){return!!e&&e.length>5},this.passwordRepeatValid=function(e,t){return!!t&&t.length>5&&t===e},this.complete=function(e,t){return!(!e||!t)&&f.passwordValid(e)&&e===t}}var r,o,i;return r=n,(o=[{key:"ngOnInit",value:function(){this.isMobile=this.walletService.isMobile(),this.isApp=this.walletService.isApp();var e=new a.b("",[a.o.required,a.o.minLength(8)]),t=new a.b("",[a.o.required]);this.form=this.formBuilder.group({passphrase:e,repeat:t},{validators:[this.isSame(e,t)]})}},{key:"isSame",value:function(e,t){return function(){return t.value===e.value?null:{notSame:!0}}}},{key:"getError",value:function(e,t){if(!e.pristine)return e.errors?Object.entries(e.errors)[0]:void 0!==t&&t.errors?Object.entries(t.errors)[0]:void 0}},{key:"downloadAndReturnLogin",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.download();case 2:this.router.navigate(["/"]),this.alertService.showMessage("LOGIN.FILE_BACK_LOGIN_ALERT.TITLE","LOGIN.FILE_BACK_LOGIN_ALERT.SUBTITLE","","LOGIN.FILE_BACK_LOGIN_ALERT.OK");case 4:case"end":return e.stop()}}),e,this)})))}},{key:"download",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.form.value.passphrase,e.prev=1,e.next=4,this.crypto.encrypt(this.mnemonic,t);case 4:return n=e.sent,e.next=7,this.dataToKeystoreJson(n);case 7:r=e.sent,this.downloadFile("mvs_keystore.json",JSON.stringify(r)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),console.log(e.t0);case 14:case"end":return e.stop()}}),e,this,[[1,11]])})))}},{key:"encrypt",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.form.value.passphrase,e.prev=1,e.next=4,this.walletService.setSeedMobile(t,this.mnemonic);case 4:return n=e.sent,e.next=7,this.walletService.setMobileWallet(n);case 7:return e.next=9,this.walletService.getWallet(t);case 9:return r=e.sent,e.next=12,this.walletService.generateAddresses(r,0,this.globals.index);case 12:return o=e.sent,e.next=15,this.metaverseService.setAddresses(o);case 15:return e.next=17,this.walletService.setVmAddressFromPassphrase(t);case 17:return e.next=19,this.walletService.getMasterPublicKey(t);case 19:return i=e.sent,e.next=22,this.walletService.setXpub(i);case 22:return e.next=24,this.walletService.saveSessionAccount(t);case 24:this.router.navigate(["/loading"],{state:{data:{reset:!0}}}),e.next=35;break;case 27:e.prev=27,e.t0=e.catch(1),e.t1=(console.error(e.t0),e.t0),e.next="illegal mnemonic"===e.t1?32:34;break;case 32:return this.alertService.showError("SELECT_PASSPHRASE.MESSAGE.ERROR_MNEMONIC",""),e.abrupt("break",35);case 34:this.alertService.showError("SELECT_PASSPHRASE.MESSAGE.ERROR",e.t0.message);case 35:case"end":return e.stop()}}),e,this,[[1,27]])})))}},{key:"downloadFile",value:function(e,t){var n=document.createElement("a");if(n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),document.createEvent){var r=document.createEvent("MouseEvents");r.initEvent("click",!0,!0),n.dispatchEvent(r)}else n.click()}},{key:"dataToKeystoreJson",value:function(e){return{version:this.globals.version,algo:this.globals.algo,index:this.globals.index,mnemonic:e}}}])&&t(r.prototype,o),i&&t(r,i),n}(),I.\u0275fac=function(e){return new(e||I)(b.Rb(u.a),b.Rb(f.e),b.Rb(p.a),b.Rb(s.eb),b.Rb(d.a),b.Rb(s.ab),b.Rb(S.a),b.Rb(a.a),b.Rb(c.h),b.Rb(m.a))},I.\u0275cmp=b.Lb({type:I,selectors:[["app-passphrase"]],decls:12,vars:2,consts:[["slot","start"],["defaultHref","/login"],["translate","SELECT_PASSPHRASE.TITLE"],["size-md","12","size-lg","6","offset-lg","3"],["translate","SELECT_PASSPHRASE.TEXT",1,"center-info"],[3,"formGroup","ngSubmit",4,"ngIf"],[4,"ngIf"],[3,"formGroup","ngSubmit"],["position","floating","translate","SELECT_PASSPHRASE.PASSWORD","color","primary",4,"ngIf"],["position","floating","color","danger",4,"ngIf"],["formControlName","passphrase","type","password","clearOnEdit","false"],["position","floating","translate","SELECT_PASSPHRASE.CONFIRM_PASSWORD","color","primary",4,"ngIf"],["formControlName","repeat","type","password","clearOnEdit","false"],["type","submit","expand","full","fill","outline","shape","round",3,"disabled",4,"ngIf"],["position","floating","translate","SELECT_PASSPHRASE.PASSWORD","color","primary"],["position","floating","color","danger"],["position","floating","translate","SELECT_PASSPHRASE.CONFIRM_PASSWORD","color","primary"],["type","submit","expand","full","fill","outline","shape","round",3,"disabled"],["slot","start","name","download"],["translate","SELECT_PASSPHRASE.BUTTON.DOWNLOAD_FILE"],["size","6"],["color","secondary","type","submit","expand","full",3,"disabled","click"],["type","submit","expand","full",3,"disabled","click"],["slot","start","name","arrow-forward"],["translate","SELECT_PASSPHRASE.BUTTON.ENTER"],["size","12"]],template:function(e,t){1&e&&(b.Xb(0,"ion-header"),b.Xb(1,"ion-toolbar"),b.Xb(2,"ion-buttons",0),b.Sb(3,"ion-back-button",1),b.Wb(),b.Sb(4,"ion-title",2),b.Wb(),b.Wb(),b.Xb(5,"ion-content"),b.Xb(6,"ion-grid"),b.Xb(7,"ion-row"),b.Xb(8,"ion-col",3),b.Sb(9,"p",4),b.Gc(10,A,10,6,"form",5),b.Wb(),b.Wb(),b.Wb(),b.Wb(),b.Gc(11,P,3,2,"ion-footer",6)),2&e&&(b.Fb(10),b.pc("ngIf",t.form),b.Fb(1),b.pc("ngIf",t.isMobile))},directives:[s.u,s.X,s.j,s.f,s.g,s.V,f.a,s.r,s.t,s.K,s.q,i.m,a.p,a.j,a.d,s.x,s.w,s.hb,a.i,a.c,s.z,s.i,s.v,s.s],pipes:[f.d,i.q],styles:[""]}),I)}],k=((O=function t(){e(this,t)}).\u0275mod=b.Pb({type:O}),O.\u0275inj=b.Ob({factory:function(e){return new(e||O)},imports:[[c.j.forChild(T)],c.j]}),O),W=((L=function t(){e(this,t)}).\u0275mod=b.Pb({type:L}),L.\u0275inj=b.Ob({factory:function(e){return new(e||L)},imports:[[i.c,a.e,s.Y,a.m,f.c.forChild(),k]]}),L)}}])}();