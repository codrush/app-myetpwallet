(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{MUVa:function(e,t,s){"use strict";s.r(t),s.d(t,"SwapPageModule",(function(){return C}));var n=s("ofXK"),i=s("3Pt+"),a=s("TEn/"),r=s("tyNb"),c=s("mrSG"),o=s("fXoL"),l=s("BZA/"),d=s("Fvwb"),h=s("OaWH"),u=s("3LUQ"),b=s("sYmb"),p=s("q5gJ");const f=["quantityInput"];function S(e,t){1&e&&o.Sb(0,"ion-spinner",7)}function m(e,t){1&e&&o.Sb(0,"p",8),2&e&&o.pc("translate","SWAP.CLOSED")}const g=function(e){return{requiredVersion:e}};function A(e,t){if(1&e&&o.Sb(0,"p",9),2&e){const e=o.jc();o.pc("translate","SWAP.UPDATE_REQUIRED")("translateParams",o.tc(2,g,e.requiredVersion))}}function v(e,t){1&e&&o.Sb(0,"p",37)}function E(e,t){1&e&&o.Sb(0,"br")}function I(e,t){1&e&&o.Sb(0,"br")}function N(e,t){1&e&&o.Sb(0,"p",38)}function T(e,t){if(1&e){const e=o.Yb();o.Xb(0,"ion-button",39),o.fc("click",(function(){return o.Ac(e),o.jc(2).sendAll()})),o.Wb()}}function w(e,t){if(1&e&&(o.Xb(0,"div",40),o.Ic(1),o.kc(2,"number"),o.Wb()),2&e){const e=o.jc(2);o.Fb(1),o.Lc(" \u2248",e.base," ",o.mc(2,2,e.fiatValue(e.quantity),"1.0-2")," ")}}function F(e,t){1&e&&o.Sb(0,"ion-item",41)}const y=function(e){return{minAmount:e}};function O(e,t){if(1&e&&(o.Sb(0,"ion-item",42),o.kc(1,"format")),2&e){const e=o.jc(2);o.pc("translateParams",o.tc(4,y,o.mc(1,1,e.minQuantity,8)))}}function _(e,t){if(1&e&&(o.Xb(0,"ion-select-option",44),o.Ic(1),o.kc(2,"format"),o.Wb()),2&e){const e=o.jc().$implicit,t=o.jc(2);o.qc("value",e.address),o.Fb(1),o.Mc(" ",e.identifier," - ",o.mc(2,4,e.balance,t.decimals)," ",t.selectedAsset,"")}}function L(e,t){if(1&e&&(o.Vb(0),o.Gc(1,_,3,7,"ion-select-option",43),o.Ub()),2&e){const e=t.$implicit;o.Fb(1),o.pc("ngIf",e.balance>0)}}function M(e,t){1&e&&o.Sb(0,"ion-item",45)}const D=function(e,t){return{"error-border":e,"valid-border":t}},R=function(e){return{"error-border":e}};function P(e,t){if(1&e){const e=o.Yb();o.Xb(0,"div"),o.Sb(1,"p",10),o.Sb(2,"p",11),o.Gc(3,v,1,0,"p",12),o.Xb(4,"ion-row"),o.Xb(5,"ion-col"),o.Xb(6,"p",13),o.Ic(7),o.kc(8,"translate"),o.Gc(9,E,1,0,"br",6),o.Ic(10),o.kc(11,"format"),o.Wb(),o.Wb(),o.Xb(12,"ion-col"),o.Xb(13,"p",14),o.Ic(14),o.kc(15,"translate"),o.Gc(16,I,1,0,"br",6),o.Ic(17),o.kc(18,"format"),o.Wb(),o.Wb(),o.Wb(),o.Gc(19,N,1,0,"p",15),o.Xb(20,"form",16,17),o.fc("ngSubmit",(function(){return o.Ac(e),o.jc().send()}))("keyup.enter",(function(){return o.Ac(e),o.jc().send()})),o.Xb(22,"ion-list"),o.Xb(23,"ion-item",18),o.Sb(24,"ion-label",19),o.Xb(25,"ion-input",20,21),o.fc("ngModelChange",(function(t){return o.Ac(e),o.jc().quantity=t})),o.Wb(),o.Gc(27,T,1,0,"ion-button",22),o.Wb(),o.Gc(28,w,3,5,"div",23),o.Gc(29,F,1,0,"ion-item",24),o.Gc(30,O,2,6,"ion-item",25),o.Sb(31,"br"),o.Xb(32,"ion-item",18),o.Sb(33,"ion-label",26),o.Xb(34,"ion-select",27),o.fc("ngModelChange",(function(t){return o.Ac(e),o.jc().sendFrom=t}))("ngModelChange",(function(){return o.Ac(e),o.jc().onFromAddressChange()})),o.kc(35,"translate"),o.kc(36,"translate"),o.Sb(37,"ion-select-option",28),o.Gc(38,L,2,1,"ng-container",29),o.Wb(),o.Wb(),o.Gc(39,M,1,0,"ion-item",30),o.Wb(),o.Xb(40,"ion-row"),o.Xb(41,"ion-col"),o.Xb(42,"ion-button",31),o.fc("click",(function(){return o.Ac(e),o.jc().cancel()})),o.Sb(43,"ion-icon",32),o.Sb(44,"span",33),o.Wb(),o.Wb(),o.Xb(45,"ion-col"),o.Xb(46,"ion-button",34),o.Sb(47,"ion-icon",35),o.Sb(48,"span",36),o.Wb(),o.Wb(),o.Wb(),o.Wb(),o.Wb()}if(2&e){const e=o.jc();o.Fb(3),o.pc("ngIf",e.swapInfo.showWarning),o.Fb(4),o.Kc("",o.lc(8,22,"SEND.AVAILABLE_BALANCE"),": "),o.Fb(2),o.pc("ngIf",e.platform.is("mobile")),o.Fb(1),o.Lc("",o.mc(11,24,e.showBalance,e.decimals)," ",e.selectedAsset,""),o.Fb(4),o.Kc("",o.lc(15,27,"SEND_SINGLE.FEE"),":"),o.Fb(2),o.pc("ngIf",e.platform.is("mobile")),o.Fb(1),o.Kc(" ",o.mc(18,29,e.fee,8)," ETP"),o.Fb(2),o.pc("ngIf",e.etpBalance<e.fee/1e8),o.Fb(4),o.pc("ngClass",o.uc(36,D,!e.validQuantity(e.quantity),e.validQuantity(e.quantity))),o.Fb(2),o.pc("ngModel",e.quantity),o.Fb(2),o.pc("ngIf",e.etpBalance>1e4),o.Fb(1),o.pc("ngIf",e.tickers&&e.tickers[e.selectedAsset]&&e.tickers[e.selectedAsset][e.base]),o.Fb(1),o.pc("ngIf",e.countDecimals(e.quantity)>e.decimals),o.Fb(1),o.pc("ngIf",e.quantity&&!e.validMinQuantity(e.quantity)),o.Fb(2),o.pc("ngClass",o.tc(39,R,!e.validFromAddress(e.sendFrom))),o.Fb(2),o.qc("okText",o.lc(35,32,"OK")),o.qc("cancelText",o.lc(36,34,"CANCEL")),o.pc("ngModel",e.sendFrom),o.Fb(4),o.pc("ngForOf",e.addressbalances),o.Fb(1),o.pc("ngIf",!e.validFromAddress(e.sendFrom)),o.Fb(7),o.pc("disabled",!e.validForm())}}var W=s("tpcZ");const j=[{path:"",component:(()=>{class e{constructor(e,t,s,n,i,a,r){this.metaverseService=e,this.walletService=t,this.appService=s,this.router=n,this.alertService=i,this.location=a,this.platform=r,this.selectedAsset="ETP",this.balances={},this.quantity="",this.sendFrom="auto",this.feeAddress="auto",this.message="",this.showAdvanced=!1,this.addressbalancesObject={},this.tickers={},this.updateRequired=!0,this.fiatValue=e=>parseFloat(e)*this.tickers[this.selectedAsset][this.base].price||0,this.validQuantity=e=>void 0!==e&&this.countDecimals(e)<=this.decimals&&this.validMinQuantity(e)&&("ETP"===this.selectedAsset&&this.showBalance>=Math.round(parseFloat(e)*Math.pow(10,this.decimals))+this.fee||"ETP"!==this.selectedAsset&&this.showBalance>=parseFloat(e)*Math.pow(10,this.decimals)),this.validMinQuantity=e=>void 0!==e&&1e8*e>=this.minQuantity,this.validFromAddress=e=>"auto"===e||this.addressbalancesObject[e]&&0!==this.addressbalancesObject[e].ETP.available,this.validMessageLength=e=>this.metaverseService.verifyMessageSize(e)<253,this.validForm=()=>this.validQuantity(this.quantity)&&this.validMessageLength(this.message)&&this.validFromAddress(this.sendFrom)}ngOnInit(){}updateBalancePerAddress(){const e=[];Object.keys(this.addresses).forEach(t=>{const s=this.addresses[t];e.push(this.addressbalancesObject[s]?{address:s,avatar:this.addressbalancesObject[s].AVATAR?this.addressbalancesObject[s].AVATAR:"",identifier:this.addressbalancesObject[s].AVATAR?this.addressbalancesObject[s].AVATAR:s,balance:"ETP"===this.selectedAsset?this.addressbalancesObject[s].ETP.available:this.addressbalancesObject[s].MST[this.selectedAsset]?this.addressbalancesObject[s].MST[this.selectedAsset].available:0}:{address:s,avatar:"",identifier:s,balance:0})}),this.addressbalances=e,"auto"!==this.sendFrom&&(!this.addressbalancesObject[this.sendFrom][this.selectedAsset]||this.addressbalancesObject[this.sendFrom][this.selectedAsset].available<Math.round(parseFloat(this.quantity)*Math.pow(10,this.decimals)))&&(this.sendFrom="auto")}init(){this.selectedAsset="ETP",this.quantity="",this.sendFrom="auto",this.feeAddress="auto",this.message="",this.showAdvanced=!1,this.vmAddress={},this.minQuantity=1e8,Promise.all([this.metaverseService.getBalances(),this.metaverseService.getAddresses(),this.metaverseService.getAddressBalances()]).then(([e,t,s])=>{this.balances=e.MST;const n="ETP"===this.selectedAsset?e.ETP:e.MST[this.selectedAsset];this.balance=n&&n.available?n.available:0,this.etpBalance=e.ETP.available,this.showBalance=this.balance,this.decimals=n.decimals,this.addresses=t,this.addressbalancesObject=s,this.updateBalancePerAddress()}),this.fee=this.appService.default_fees.default,this.defaultFee=this.fee,this.metaverseService.getFees().then(e=>{this.fee=e.default,this.defaultFee=this.fee}),this.swapAddress="testnet"===this.appService.network?this.appService.testnetMetaverseSwapAddress:this.appService.mainnetMetaverseSwapAddress}ionViewDidEnter(){return Object(c.a)(this,void 0,void 0,(function*(){this.init();const e=yield this.metaverseService.getAddresses(),t=yield this.walletService.getVmAddresses();Array.isArray(e)&&e.length?t&&t.length&&t[0]?!1===(yield this.walletService.validWeb3Address(t[0].address))?(this.alertService.showMessage("SWAP.INVALID_VM_ADDRESS.TITLE","SWAP.INVALID_VM_ADDRESS.SUBTITLE",""),this.router.navigate(["account","portfolio"])):(this.vmAddress=t[0],this.swapInfo=yield this.metaverseService.getSwapInfo(),this.requiredVersion=this.swapInfo.minVersion,this.updateRequired=-1==W(this.appService.version,this.requiredVersion),this.minQuantity=this.swapInfo.minQuantity||1e8,this.loadTickers()):(this.alertService.showMessage("SWAP.NO_VM_ADDRESS.TITLE","SWAP.NO_VM_ADDRESS.SUBTITLE",""),this.router.navigate(["account","identities","generate-vm-address"])):this.router.navigate(["login"])}))}loadTickers(){return Object(c.a)(this,void 0,void 0,(function*(){[this.base,this.tickers]=yield this.metaverseService.getBaseAndTickers()}))}countDecimals(e){return Math.floor(e)!==e&&e.toString().split(".").length>1&&e.toString().split(".")[1].length||0}sendAll(){return Object(c.a)(this,void 0,void 0,(function*(){(yield this.alertService.alertConfirm("SEND_SINGLE.ALL.TITLE","SEND_SINGLE.ALL.SUBTITLE","SEND_SINGLE.ALL.CANCEL","SEND_SINGLE.ALL.OK"))&&(this.quantity="ETP"===this.selectedAsset?parseFloat((this.showBalance/1e8-this.fee/1e8).toFixed(this.decimals)+"")+"":parseFloat((this.showBalance/Math.pow(10,this.decimals)).toFixed(this.decimals)+"")+"",this.quantityInput.setFocus())}))}create(){return Object(c.a)(this,void 0,void 0,(function*(){try{yield this.alertService.showLoading();const e=[];return e.push(this.vmAddress.address),this.showAdvanced&&this.message&&e.push(this.message),this.metaverseService.createSendTx(this.selectedAsset,this.swapAddress,"Burn",Math.round(parseFloat(this.quantity)*Math.pow(10,this.decimals)),"auto"!==this.sendFrom?this.sendFrom:null,this.showAdvanced&&"auto"!==this.changeAddress?this.changeAddress:void 0,this.showAdvanced?this.fee:this.defaultFee,e!==[]?e:void 0)}catch(e){throw console.error(e.message),this.alertService.stopLoading(),Error(e)}}))}send(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.validForm())try{const e=[];this.message&&e.push(this.message);const t=(yield this.create()).encode().toString("hex");this.alertService.stopLoading(),this.router.navigate(["account","confirm"],{state:{data:{tx:t}}})}catch(e){switch(console.error(e),this.alertService.stopLoading(),e.message){case"ERR_INSUFFICIENT_BALANCE":this.alertService.showError("SEND.MESSAGE.INSUFFICIENT_BALANCE","");break;case"ERR_TOO_MANY_INPUTS":this.alertService.showErrorTranslated("SEND.MESSAGE.ERROR_TOO_MANY_INPUTS","SEND.MESSAGE.ERROR_TOO_MANY_INPUTS_TEXT");break;default:this.alertService.showError("SEND.MESSAGE.CREATE_TRANSACTION",e.message)}}}))}cancel(){this.location.back()}onFromAddressChange(){"auto"===this.sendFrom?this.showBalance=this.balance:this.addressbalances.length&&this.addressbalances.forEach(e=>{e.address===this.sendFrom&&(this.showBalance=e.balance)})}}return e.\u0275fac=function(t){return new(t||e)(o.Rb(l.a),o.Rb(d.a),o.Rb(h.a),o.Rb(r.h),o.Rb(u.a),o.Rb(n.i),o.Rb(a.eb))},e.\u0275cmp=o.Lb({type:e,selectors:[["app-swap"]],viewQuery:function(e,t){var s;1&e&&o.Nc(f,!0),2&e&&o.xc(s=o.gc())&&(t.quantityInput=s.first)},decls:11,vars:4,consts:[["slot","start"],["defaultHref","/account/portfolio"],["translate","SWAP.TITLE"],["name","dots",4,"ngIf"],["class","center",3,"translate",4,"ngIf"],["class","center",3,"translate","translateParams",4,"ngIf"],[4,"ngIf"],["name","dots"],[1,"center",3,"translate"],[1,"center",3,"translate","translateParams"],["align","center","translate","SWAP.EXPLANATION"],["align","center","translate","SWAP.WARNING_RED",1,"wrong-input"],["align","center","translate","SWAP.WARNING",4,"ngIf"],[1,"available"],[1,"right"],["align","center","class","wrong-input","translate","SEND.NOTICE_TRANSACTION_FEE_UNCOVERED",4,"ngIf"],[3,"ngSubmit","keyup.enter"],["sendForm","ngForm"],[3,"ngClass"],["color","primary","position","floating","translate","SEND_SINGLE.AMOUNT"],["name","quantity","type","number","min","0","required","",3,"ngModel","ngModelChange"],["quantityInput",""],["slot","end","type","button","fill","outline","shape","round","id","sendAll","translate","SEND_SINGLE.BUTTON.SEND_ALL",3,"click",4,"ngIf"],["class","advice",4,"ngIf"],["lines","none","class","wrong-input","translate","SEND.TOO_MANY_DECIMALS",4,"ngIf"],["lines","none","class","wrong-input","translate","SWAP.LOWER_MIN_AMOUNT",3,"translateParams",4,"ngIf"],["translate","SEND_SINGLE.SEND_FROM"],["name","sendfrom","multiple","false",3,"ngModel","okText","cancelText","ngModelChange"],["selected","true","value","auto","translate","SEND_SINGLE.SEND_FROM_AUTO"],[4,"ngFor","ngForOf"],["lines","none","class","wrong-input","translate","SEND_SINGLE.FROM_ADDRESS_NO_ETP",4,"ngIf"],["color","danger","expand","full","fill","outline","shape","round",3,"click"],["slot","start","name","close"],["translate","SEND_SINGLE.BUTTON.CANCEL"],["type","submit","expand","full","color","primary","fill","outline","shape","round",3,"disabled"],["slot","start","disabled","checked","name","cog"],["translate","SEND_SINGLE.BUTTON.NEXT"],["align","center","translate","SWAP.WARNING"],["align","center","translate","SEND.NOTICE_TRANSACTION_FEE_UNCOVERED",1,"wrong-input"],["slot","end","type","button","fill","outline","shape","round","id","sendAll","translate","SEND_SINGLE.BUTTON.SEND_ALL",3,"click"],[1,"advice"],["lines","none","translate","SEND.TOO_MANY_DECIMALS",1,"wrong-input"],["lines","none","translate","SWAP.LOWER_MIN_AMOUNT",1,"wrong-input",3,"translateParams"],[3,"value",4,"ngIf"],[3,"value"],["lines","none","translate","SEND_SINGLE.FROM_ADDRESS_NO_ETP",1,"wrong-input"]],template:function(e,t){1&e&&(o.Xb(0,"ion-header"),o.Xb(1,"ion-toolbar"),o.Xb(2,"ion-buttons",0),o.Sb(3,"ion-back-button",1),o.Wb(),o.Sb(4,"ion-title",2),o.Wb(),o.Wb(),o.Xb(5,"ion-content"),o.Sb(6,"br"),o.Gc(7,S,1,0,"ion-spinner",3),o.Gc(8,m,1,1,"p",4),o.Gc(9,A,1,4,"p",5),o.Gc(10,P,49,41,"div",6),o.Wb()),2&e&&(o.Fb(7),o.pc("ngIf",!t.swapInfo),o.Fb(1),o.pc("ngIf",t.swapInfo&&!t.swapInfo.open),o.Fb(1),o.pc("ngIf",t.swapInfo&&t.swapInfo.open&&t.updateRequired),o.Fb(1),o.pc("ngIf",t.swapInfo&&t.swapInfo.open&&!t.updateRequired))},directives:[a.u,a.X,a.j,a.f,a.g,a.V,b.a,a.r,n.m,a.R,a.K,a.q,i.p,i.j,i.k,a.A,a.x,n.k,a.z,a.w,a.db,i.n,i.i,i.l,a.N,a.gb,a.O,n.l,a.i,a.v],pipes:[b.d,p.a,n.f],styles:["#sendAll[_ngcontent-%COMP%]{height:34px;margin-top:20px}"]}),e})()}];let k=(()=>{class e{}return e.\u0275mod=o.Pb({type:e}),e.\u0275inj=o.Ob({factory:function(t){return new(t||e)},imports:[[r.j.forChild(j)],r.j]}),e})();var G=s("iTUp");let C=(()=>{class e{}return e.\u0275mod=o.Pb({type:e}),e.\u0275inj=o.Ob({factory:function(t){return new(t||e)},imports:[[n.c,i.e,a.Y,b.c.forChild(),G.a,k]]}),e})()},iTUp:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var n=s("ofXK"),i=s("fXoL");let a=(()=>{class e{}return e.\u0275mod=i.Pb({type:e}),e.\u0275inj=i.Ob({factory:function(t){return new(t||e)},imports:[[n.c]]}),e})()},q5gJ:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s("fXoL");let i=(()=>{class e{transform(e,t){return(e/Math.pow(10,t)).toLocaleString(void 0,{maximumFractionDigits:t})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=n.Qb({name:"format",type:e,pure:!0}),e})()},tpcZ:function(e,t,s){var n,i;void 0===(i="function"==typeof(n=function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function t(e){var t,s=e.replace(/^v/,"").replace(/\+.*$/,""),n=-1===(t=s).indexOf("-")?t.length:t.indexOf("-"),i=s.substring(0,n).split(".");return i.push(s.substring(n+1)),i}function s(e){return isNaN(Number(e))?e:Number(e)}function n(t){if("string"!=typeof t)throw new TypeError("Invalid argument expected string");if(!e.test(t))throw new Error("Invalid argument not valid semver ('"+t+"' received)")}function i(e,i){[e,i].forEach(n);for(var a=t(e),r=t(i),c=0;c<Math.max(a.length-1,r.length-1);c++){var o=parseInt(a[c]||0,10),l=parseInt(r[c]||0,10);if(o>l)return 1;if(l>o)return-1}var d=a[a.length-1],h=r[r.length-1];if(d&&h){var u=d.split(".").map(s),b=h.split(".").map(s);for(c=0;c<Math.max(u.length,b.length);c++){if(void 0===u[c]||"string"==typeof b[c]&&"number"==typeof u[c])return-1;if(void 0===b[c]||"string"==typeof u[c]&&"number"==typeof b[c])return 1;if(u[c]>b[c])return 1;if(b[c]>u[c])return-1}}else if(d||h)return d?-1:1;return 0}var a=[">",">=","=","<","<="],r={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};return i.validate=function(t){return"string"==typeof t&&e.test(t)},i.compare=function(e,t,s){!function(e){if("string"!=typeof e)throw new TypeError("Invalid operator type, expected string but got "+typeof e);if(-1===a.indexOf(e))throw new TypeError("Invalid operator, expected one of "+a.join("|"))}(s);var n=i(e,t);return r[s].indexOf(n)>-1},i})?n.apply(t,[]):n)||(e.exports=i)}}]);