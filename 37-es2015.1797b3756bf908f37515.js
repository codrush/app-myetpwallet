(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{ktNH:function(t,e,i){"use strict";i.r(e),i.d(e,"ConfirmPageModule",(function(){return X}));var s=i("ofXK"),n=i("3Pt+"),o=i("TEn/"),r=i("tyNb"),a=i("mrSG"),c=i("fXoL"),l=i("BZA/"),d=i("Fvwb"),b=i("3LUQ"),u=i("Dvla"),h=i("sYmb"),S=i("tmR0");function p(t,e){if(1&t&&c.Sb(0,"tx-item",16),2&t){const t=c.jc();c.pc("tx",t.displayedTx)("hexTx",t.hexTx)("mode",t.mode)("status",t.status)("multisig",t.multisig)("addresses",t.addresses)}}function I(t,e){1&t&&(c.Xb(0,"ion-item",17),c.Ic(1),c.kc(2,"translate"),c.Wb()),2&t&&(c.Fb(1),c.Jc(c.lc(2,1,"TX.INPUTS_NOT_ALL_MINE")))}const T=function(t){return{"error-border":t}};function f(t,e){if(1&t){const t=c.Yb();c.Xb(0,"ion-item",18),c.Sb(1,"ion-label",19),c.Xb(2,"ion-input",20),c.fc("ngModelChange",(function(e){return c.Ac(t),c.jc().passphrase=e})),c.Wb(),c.Wb()}if(2&t){const t=c.jc();c.pc("ngClass",c.tc(2,T,!t.validPassword(t.passphrase))),c.Fb(2),c.pc("ngModel",t.passphrase)}}function g(t,e){if(1&t){const t=c.Yb();c.Xb(0,"ion-item",21),c.Sb(1,"ion-label",22),c.Xb(2,"ion-toggle",23),c.fc("ngModelChange",(function(e){return c.Ac(t),c.jc().showAdvanced=e})),c.Wb(),c.Wb()}if(2&t){const t=c.jc();c.Fb(2),c.pc("ngModel",t.showAdvanced)}}function E(t,e){1&t&&(c.Xb(0,"ion-item",17),c.Sb(1,"span",27),c.Wb())}function N(t,e){if(1&t){const t=c.Yb();c.Xb(0,"ion-col"),c.Xb(1,"ion-button",24),c.fc("click",(function(){return c.Ac(t),c.jc(2).preview()})),c.Sb(2,"ion-icon",25),c.Sb(3,"span",26),c.Wb(),c.Gc(4,E,2,0,"ion-item",12),c.Wb()}if(2&t){const t=c.jc(2),e=c.yc(7);c.Fb(1),c.pc("disabled",!e.form.valid||!t.validPassword(t.passphrase)||"MULTISIG"==t.multisig.status&&t.multisig.selfSigned),c.Fb(3),c.pc("ngIf","MULTISIG"==t.multisig.status&&t.multisig.selfSigned)}}function R(t,e){if(1&t){const t=c.Yb();c.Xb(0,"ion-col"),c.Sb(1,"br"),c.Sb(2,"h4",28),c.Xb(3,"ion-item",29),c.Ic(4),c.Wb(),c.Xb(5,"ion-button",30),c.fc("click",(function(){c.Ac(t);const e=c.jc(2);return e.walletService.copy(e.signedTx,"tx")})),c.Sb(6,"ion-icon",31),c.Sb(7,"span",32),c.Wb(),c.Wb()}if(2&t){const t=c.jc(2);c.Fb(4),c.Jc(t.signedTx)}}function m(t,e){if(1&t&&(c.Xb(0,"div"),c.Xb(1,"ion-row"),c.Gc(2,N,5,2,"ion-col",15),c.Wb(),c.Xb(3,"ion-row"),c.Gc(4,R,8,1,"ion-col",15),c.Wb(),c.Wb()),2&t){const t=c.jc();c.Fb(2),c.pc("ngIf","SIGNED"!=t.status),c.Fb(2),c.pc("ngIf",t.signedTx)}}function O(t,e){if(1&t&&(c.Xb(0,"div"),c.Xb(1,"ion-row"),c.Xb(2,"ion-col"),c.Sb(3,"h4",33),c.Xb(4,"ion-item",29),c.Ic(5),c.Wb(),c.Wb(),c.Wb(),c.Wb()),2&t){const t=c.jc();c.Fb(5),c.Jc(t.hexTx)}}function _(t,e){if(1&t&&(c.Xb(0,"ion-button",39),c.Sb(1,"ion-icon",40),c.Sb(2,"span",41),c.Wb()),2&t){const t=c.jc(2),e=c.yc(7);c.pc("disabled",!e.form.valid||!t.validPassword(t.passphrase)||"MULTISIG"==t.multisig.status&&(t.multisig.selfSigned||t.multisig.info.m+1<t.multisig.info.n))}}function M(t,e){1&t&&(c.Xb(0,"ion-button",42),c.Sb(1,"ion-icon",40),c.Sb(2,"span",43),c.Wb())}function v(t,e){if(1&t){const t=c.Yb();c.Xb(0,"ion-row"),c.Xb(1,"ion-col"),c.Xb(2,"ion-button",34),c.fc("click",(function(){return c.Ac(t),c.jc().cancel()})),c.Sb(3,"ion-icon",35),c.Sb(4,"span",36),c.Wb(),c.Wb(),c.Xb(5,"ion-col"),c.Gc(6,_,3,1,"ion-button",37),c.Gc(7,M,3,0,"ion-button",38),c.Wb(),c.Wb()}if(2&t){const t=c.jc();c.Fb(6),c.pc("ngIf","SIGNED"!=t.status),c.Fb(1),c.pc("ngIf","SIGNED"==t.status)}}function A(t,e){1&t&&(c.Xb(0,"ion-button",49),c.Sb(1,"ion-icon",40),c.Sb(2,"span",43),c.Wb())}function w(t,e){if(1&t){const t=c.Yb();c.Xb(0,"ion-button",50),c.fc("click",(function(){c.Ac(t);const e=c.jc(2);return e.walletService.copy(e.hexTx,"tx")})),c.Sb(1,"ion-icon",31),c.Sb(2,"span",51),c.Wb()}}function y(t,e){if(1&t){const t=c.Yb();c.Xb(0,"ion-row"),c.Xb(1,"ion-col"),c.Xb(2,"ion-button",44),c.fc("click",(function(e){return c.Ac(t),c.jc().home(e)})),c.Sb(3,"ion-icon",45),c.Sb(4,"span",46),c.Wb(),c.Wb(),c.Xb(5,"ion-col"),c.Gc(6,A,3,0,"ion-button",47),c.Gc(7,w,3,0,"ion-button",48),c.Wb(),c.Wb()}if(2&t){const t=c.jc();c.Fb(6),c.pc("ngIf","SIGNED"==t.status),c.Fb(1),c.pc("ngIf","SIGNED"!==t.status)}}const C=[{path:"",component:(()=>{class t{constructor(t,e,i,s,n){this.mvs=t,this.router=e,this.walletService=i,this.alertService=s,this.clipboardService=n,this.passphrase="",this.mode="default",this.allMyInputs=!0,this.addresses=[],this.multisig={},this.walletType="hasSeed",this.showAdvanced=!1,this.validPassword=t=>t.length>0}ngOnInit(){}ionViewDidEnter(){return Object(a.a)(this,void 0,void 0,(function*(){this.hexTx=history.state.data?history.state.data.tx:void 0,void 0===this.hexTx?this.router.navigate(["account","portfolio"]):this.decodeAndOrganize(this.hexTx);const t=yield this.mvs.getAddresses(),e=yield this.walletService.getMultisigAddresses();this.addresses=t.concat(e),this.walletService.hasSeed().then(t=>{this.walletType=t?"hasSeed":"readOnly"})}))}cancel(){this.router.navigate(["account","portfolio"])}home(t){this.router.navigate(["account","portfolio"])}preview(){return Object(a.a)(this,void 0,void 0,(function*(){yield this.alertService.showLoading();try{const t=yield this.sign();this.signedTx=yield t.encode().toString("hex"),this.hexTx=this.signedTx,this.decodeAndOrganize(this.signedTx),this.alertService.stopLoading()}catch(t){this.alertService.stopLoading(),console.error(t.message)}}))}decodeAndOrganize(t){return Object(a.a)(this,void 0,void 0,(function*(){this.decodedTx=yield this.mvs.decodeTx(t),this.displayedTx=yield this.mvs.organizeTx(JSON.parse(JSON.stringify(this.decodedTx))),this.checkTxSignStatus(this.displayedTx)}))}send(){return Object(a.a)(this,void 0,void 0,(function*(){try{yield this.alertService.showLoading();const t=yield this.sign();yield this.broadcast(t)}catch(t){}}))}broadcastOnly(t){return Object(a.a)(this,void 0,void 0,(function*(){try{yield this.alertService.showLoading(),yield this.broadcast(t)}catch(e){}}))}broadcast(t){return Object(a.a)(this,void 0,void 0,(function*(){try{const e=yield this.mvs.send(t);this.alertService.stopLoading(),this.router.navigate(["account","portfolio"]),this.alertService.showMessage("CONFIRM.CONFIRM_ALERT.TITLE","CONFIRM.CONFIRM_ALERT.SUBTITLE",e.hash,"CONFIRM.CONFIRM_ALERT.OK")}catch(e){switch(this.alertService.stopLoading(),console.error(e.message),e.message){case"ERR_CONNECTION":this.alertService.showError("CONFIRM.MESSAGE.ERROR_SEND_TEXT","");break;case"ERR_SIGN_TX":break;default:throw this.alertService.showError("CONFIRM.MESSAGE.BROADCAST_TRANSACTION",e.message),Error("ERR_BROADCAST_TX")}}}))}sign(){return"MULTISIG"===this.multisig.status?this.walletService.signMultisigTx(this.decodedTx.inputs[0].address,this.decodedTx,this.passphrase).catch(t=>{switch(console.error(t.message),this.alertService.stopLoading(),t.message){case"ERR_DECRYPT_WALLET":case"ERR_DECRYPT_WALLET_FROM_SEED":throw this.alertService.showError("CONFIRM.MESSAGE.PASSWORD_WRONG",""),Error("ERR_SIGN_TX");case"ERR_INSUFFICIENT_BALANCE":throw this.alertService.showError("CONFIRM.MESSAGE.INSUFFICIENT_BALANCE",""),Error("ERR_SIGN_TX");case"ERR_TOO_MANY_INPUTS":throw this.alertService.showErrorTranslated("CONFIRM.MESSAGE.ERROR_TOO_MANY_INPUTS","CONFIRM.MESSAGE.ERROR_TOO_MANY_INPUTS_TEXT"),Error("ERR_SIGN_TX");case"SIGN_ALREADY_INCL":throw this.alertService.showError("CONFIRM.MESSAGE.ALREADY_SIGN_TRANSACTION",""),Error("ERR_SIGN_TX");default:throw this.alertService.showError("CONFIRM.MESSAGE.SIGN_TRANSACTION",t.message),Error("ERR_SIGN_TX")}}):this.mvs.sign(this.decodedTx,this.passphrase,this.allMyInputs).catch(t=>{switch(console.error(t.message),this.alertService.stopLoading(),t.message){case"ERR_DECRYPT_WALLET":case"ERR_DECRYPT_WALLET_FROM_SEED":throw this.alertService.showError("CONFIRM.MESSAGE.PASSWORD_WRONG",""),Error("ERR_SIGN_TX");case"ERR_INSUFFICIENT_BALANCE":throw this.alertService.showError("CONFIRM.MESSAGE.INSUFFICIENT_BALANCE",""),Error("ERR_SIGN_TX");case"ERR_TOO_MANY_INPUTS":throw this.alertService.showErrorTranslated("CONFIRM.MESSAGE.ERROR_TOO_MANY_INPUTS","CONFIRM.MESSAGE.ERROR_TOO_MANY_INPUTS_TEXT"),Error("ERR_SIGN_TX");default:throw this.alertService.showError("CONFIRM.MESSAGE.SIGN_TRANSACTION",t.message),Error("ERR_SIGN_TX")}})}checkTxSignStatus(t){return Object(a.a)(this,void 0,void 0,(function*(){let e=!1,i=!1,s=!1,n=!1,o="",r=!1;for(let a=0;a<t.inputs.length;a++){const c=t.inputs[a];if("3"===c.address[0]){n=!0,this.multisig.current_nbr_sign=c.script.split("[").length-2,this.multisig.info=yield this.getMultisigInfo(c.address);const t=yield this.mvs.getSignatureStatus(this.decodedTx,a,this.multisig.info.r,this.multisig.info.s);this.multisig.selfSigned=t.targetSigned,t.complete?e=!0:i=!0,o&&o!==c.address?r=!0:o=c.address}else s=!0,c.script?e=!0:i=!0;-1===this.addresses.indexOf(c.previous_output.address)&&(this.allMyInputs=!1)}this.status=e&&!i?"SIGNED":!e&&i?"UNSIGNED":"PARTIALLY",this.multisig.status=r?"MIX_MULTISIG":n&&!s?"MULTISIG":!n&&s?"NOT_MULTISIG":"PARTIALLY_MULTISIG"}))}getMultisigInfo(t){return Object(a.a)(this,void 0,void 0,(function*(){const e=yield this.walletService.getMultisigsInfo();let i={};return e.forEach(e=>{e.a===t&&(i=e)}),i}))}submit(){"SIGNED"===status?this.broadcastOnly(this.decodedTx):"hasSeed"===this.walletType?this.send():"readOnly"===this.walletType&&this.clipboardService.copyFromContent(this.hexTx)}}return t.\u0275fac=function(e){return new(e||t)(c.Rb(l.a),c.Rb(r.h),c.Rb(d.a),c.Rb(b.a),c.Rb(u.b))},t.\u0275cmp=c.Lb({type:t,selectors:[["app-confirm"]],decls:32,vars:24,consts:[["slot","start"],["defaultHref","/account/portfolio"],["translate","CONFIRM.TITLE"],[3,"ngSubmit"],["signTxForm","ngForm"],["translate","CONFIRM.PAGE_TITLE"],["translate","TX.SELECT_MODE"],["name","mode","multiple","false",3,"ngModel","okText","cancelText","ngModelChange"],["selected","true","value","default"],["value","satoshi"],["value","hex"],[3,"tx","hexTx","mode","status","multisig","addresses",4,"ngIf"],["lines","none","class","wrong-input",4,"ngIf"],[3,"ngClass",4,"ngIf"],["class","toggle-input",4,"ngIf"],[4,"ngIf"],[3,"tx","hexTx","mode","status","multisig","addresses"],["lines","none",1,"wrong-input"],[3,"ngClass"],["color","primary","position","floating","translate","CONFIRM.PASSWORD"],["name","passphrase","type","password","required","",3,"ngModel","ngModelChange"],[1,"toggle-input"],["translate","CONFIRM.SHOW_ADVANCED"],["name","showAdvanced","checked","false",3,"ngModel","ngModelChange"],["expand","full","fill","outline","shape","round","color","primary",3,"disabled","click"],["slot","start","name","create"],["translate","CONFIRM.BUTTON.SIGN_ONLY"],["translate","MULTISIG_ALREADY_SIGNED"],["translate","CONFIRM.PREVIEW_SIGNED_TX"],[1,"manual-copy","breakwords"],["expand","full","fill","outline","shape","round",3,"click"],["slot","start","name","copy"],["translate","COPY"],["translate","CONFIRM.PREVIEW_UNSIGNED_TX"],["color","danger","fill","outline","shape","round","expand","full",3,"click"],["slot","start","name","close"],["translate","CONFIRM.BUTTON.CANCEL"],["type","submit","expand","full","fill","outline","shape","round","color","primary",3,"disabled",4,"ngIf"],["type","submit","expand","full","fill","outline","shape","round","color","primary",4,"ngIf"],["type","submit","expand","full","fill","outline","shape","round","color","primary",3,"disabled"],["slot","start","name","send"],["translate","CONFIRM.BUTTON.SIGN_AND_SEND"],["type","submit","expand","full","fill","outline","shape","round","color","primary"],["translate","CONFIRM.BUTTON.BROADCAST"],["color","secondary","expand","full",3,"click"],["slot","start","name","arrow-back"],["translate","CONFIRM.BUTTON.RETURN_HOME"],["type","submit","expand","full","color","secondary",4,"ngIf"],["type","submit","expand","full",3,"click",4,"ngIf"],["type","submit","expand","full","color","secondary"],["type","submit","expand","full",3,"click"],["translate","CONFIRM.BUTTON.COPY"]],template:function(t,e){1&t&&(c.Xb(0,"ion-header"),c.Xb(1,"ion-toolbar"),c.Xb(2,"ion-buttons",0),c.Sb(3,"ion-back-button",1),c.Wb(),c.Sb(4,"ion-title",2),c.Wb(),c.Wb(),c.Xb(5,"ion-content"),c.Xb(6,"form",3,4),c.fc("ngSubmit",(function(){return e.submit()})),c.Sb(8,"h2",5),c.Xb(9,"ion-item"),c.Sb(10,"ion-label",6),c.Xb(11,"ion-select",7),c.fc("ngModelChange",(function(t){return e.mode=t})),c.kc(12,"translate"),c.kc(13,"translate"),c.Xb(14,"ion-select-option",8),c.Ic(15),c.kc(16,"translate"),c.Wb(),c.Xb(17,"ion-select-option",9),c.Ic(18),c.kc(19,"translate"),c.Wb(),c.Xb(20,"ion-select-option",10),c.Ic(21),c.kc(22,"translate"),c.Wb(),c.Wb(),c.Wb(),c.Gc(23,p,1,6,"tx-item",11),c.Gc(24,I,3,3,"ion-item",12),c.Gc(25,f,3,4,"ion-item",13),c.Sb(26,"br"),c.Gc(27,g,3,1,"ion-item",14),c.Gc(28,m,5,2,"div",15),c.Gc(29,O,6,1,"div",15),c.Gc(30,v,8,2,"ion-row",15),c.Gc(31,y,8,2,"ion-row",15),c.Wb(),c.Wb()),2&t&&(c.Fb(11),c.qc("okText",c.lc(12,14,"OK")),c.qc("cancelText",c.lc(13,16,"CANCEL")),c.pc("ngModel",e.mode),c.Fb(4),c.Jc(c.lc(16,18,"TX.MODE.DEFAULT")),c.Fb(3),c.Jc(c.lc(19,20,"TX.MODE.SATOSHI")),c.Fb(3),c.Jc(c.lc(22,22,"TX.MODE.HEX")),c.Fb(2),c.pc("ngIf",e.displayedTx),c.Fb(1),c.pc("ngIf",!e.allMyInputs),c.Fb(1),c.pc("ngIf","SIGNED"!=e.status&&"hasSeed"==e.walletType),c.Fb(2),c.pc("ngIf","MULTISIG"!=e.multisig.status&&"readOnly"!==e.walletType),c.Fb(1),c.pc("ngIf",e.showAdvanced||"MULTISIG"==e.multisig.status),c.Fb(1),c.pc("ngIf","readOnly"==e.walletType),c.Fb(1),c.pc("ngIf","hasSeed"==e.walletType),c.Fb(1),c.pc("ngIf","readOnly"==e.walletType))},directives:[o.u,o.X,o.j,o.f,o.g,o.V,h.a,o.r,n.p,n.j,n.k,o.x,o.z,o.N,o.gb,n.i,n.l,o.O,s.m,S.a,s.k,o.w,o.hb,n.n,o.W,o.c,o.K,o.q,o.i,o.v],pipes:[h.d],styles:[""]}),t})()}];let x=(()=>{class t{}return t.\u0275mod=c.Pb({type:t}),t.\u0275inj=c.Ob({factory:function(e){return new(e||t)},imports:[[r.j.forChild(C)],r.j]}),t})();var F=i("awj6"),G=i("iTUp");let X=(()=>{class t{}return t.\u0275mod=c.Pb({type:t}),t.\u0275inj=c.Ob({factory:function(e){return new(e||t)},imports:[[s.c,n.e,o.Y,h.c.forChild(),G.a,F.a,x]]}),t})()}}]);