(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{"/wb0":function(e,t,i){"use strict";i.r(t),i.d(t,"SendVmPageModule",(function(){return X}));var n=i("ofXK"),s=i("3Pt+"),a=i("TEn/"),c=i("tyNb"),r=i("mrSG"),o=i("gddX"),d=i("fXoL"),l=i("BZA/"),b=i("Fvwb"),u=i("OaWH"),h=i("3LUQ"),p=i("m5Kd"),S=i("sYmb"),g=i("q5gJ");const A=["recipientAddressInput"],f=["quantityInput"];function m(e,t){1&e&&d.Sb(0,"ion-spinner",3)}function v(e,t){1&e&&d.Sb(0,"br")}function E(e,t){if(1&e&&(d.Xb(0,"span"),d.Ic(1),d.kc(2,"format"),d.Wb()),2&e){const e=d.jc(2);d.Fb(1),d.Lc("",d.mc(2,2,e.vmAddress.balance,e.decimals)," ",e.selectedAsset,"")}}function I(e,t){1&e&&d.Sb(0,"ion-spinner",30)}function N(e,t){1&e&&d.Sb(0,"br")}function _(e,t){1&e&&d.Sb(0,"p",31)}function M(e,t){if(1&e){const e=d.Yb();d.Xb(0,"ion-button",32),d.fc("click",(function(){return d.Ac(e),d.jc(2).scan()})),d.Sb(1,"ion-icon",33),d.Wb()}}function T(e,t){if(1&e&&(d.Xb(0,"div",34),d.Ic(1),d.kc(2,"number"),d.Wb()),2&e){const e=d.jc(2);d.Fb(1),d.Lc(" \u2248",e.base," ",d.mc(2,2,e.fiatValue(e.quantity),"1.0-2")," ")}}function y(e,t){1&e&&d.Sb(0,"ion-item",35)}const D=function(e,t){return{"error-border":e,"valid-border":t}};function L(e,t){if(1&e){const e=d.Yb();d.Xb(0,"div"),d.Xb(1,"ion-item",10),d.Sb(2,"ion-label",36),d.Xb(3,"ion-input",37),d.fc("ngModelChange",(function(t){return d.Ac(e),d.jc(2).gasPriceSatoshi=t})),d.Wb(),d.Wb(),d.Xb(4,"ion-item",10),d.Sb(5,"ion-label",38),d.Xb(6,"ion-input",39),d.fc("ngModelChange",(function(t){return d.Ac(e),d.jc(2).gas=t})),d.Wb(),d.Wb(),d.Wb()}if(2&e){const e=d.jc(2);d.Fb(1),d.pc("ngClass",d.uc(4,D,!e.validGasPrice(e.gasPriceSatoshi),e.validGasPrice(e.gasPriceSatoshi))),d.Fb(2),d.pc("ngModel",e.gasPriceSatoshi),d.Fb(1),d.pc("ngClass",d.uc(7,D,!e.validGas(e.gas),e.validGas(e.gas))),d.Fb(2),d.pc("ngModel",e.gas)}}function C(e,t){if(1&e){const e=d.Yb();d.Xb(0,"div"),d.Xb(1,"ion-row"),d.Xb(2,"ion-col"),d.Xb(3,"p",4),d.Ic(4),d.kc(5,"translate"),d.Gc(6,v,1,0,"br",2),d.Gc(7,E,3,5,"span",2),d.Gc(8,I,1,0,"ion-spinner",5),d.Wb(),d.Wb(),d.Xb(9,"ion-col"),d.Xb(10,"p",6),d.Ic(11),d.kc(12,"translate"),d.Gc(13,N,1,0,"br",2),d.Ic(14),d.kc(15,"format"),d.Wb(),d.Wb(),d.Wb(),d.Gc(16,_,1,0,"p",7),d.Xb(17,"form",8,9),d.fc("ngSubmit",(function(){return d.Ac(e),d.jc().send()}))("keyup.enter",(function(){return d.Ac(e),d.jc().send()})),d.Xb(19,"ion-list"),d.Xb(20,"ion-item",10),d.Sb(21,"ion-label",11),d.Xb(22,"ion-input",12,13),d.fc("ngModelChange",(function(t){return d.Ac(e),d.jc().recipientAddress=t}))("ngModelChange",(function(){return d.Ac(e),d.jc().recipientChanged()})),d.Wb(),d.Gc(24,M,2,0,"ion-button",14),d.Wb(),d.Xb(25,"ion-item",10),d.Sb(26,"ion-label",15),d.Xb(27,"ion-input",16,17),d.fc("ngModelChange",(function(t){return d.Ac(e),d.jc().quantity=t})),d.Wb(),d.Xb(29,"ion-button",18),d.fc("click",(function(){return d.Ac(e),d.jc().sendAll()})),d.Wb(),d.Wb(),d.Gc(30,T,3,5,"div",19),d.Gc(31,y,1,0,"ion-item",20),d.Sb(32,"br"),d.Xb(33,"ion-item",21),d.Sb(34,"ion-label",22),d.Xb(35,"ion-toggle",23),d.fc("ngModelChange",(function(t){return d.Ac(e),d.jc().showAdvanced=t})),d.Wb(),d.Wb(),d.Gc(36,L,7,10,"div",2),d.Wb(),d.Xb(37,"ion-row"),d.Xb(38,"ion-col"),d.Xb(39,"ion-button",24),d.fc("click",(function(){return d.Ac(e),d.jc().cancel()})),d.Sb(40,"ion-icon",25),d.Sb(41,"span",26),d.Wb(),d.Wb(),d.Xb(42,"ion-col"),d.Xb(43,"ion-button",27),d.Sb(44,"ion-icon",28),d.Sb(45,"span",29),d.Wb(),d.Wb(),d.Wb(),d.Wb(),d.Wb()}if(2&e){const e=d.jc();d.Fb(4),d.Kc("",d.lc(5,17,"SEND.AVAILABLE_BALANCE"),": "),d.Fb(2),d.pc("ngIf",e.platform.is("mobile")),d.Fb(1),d.pc("ngIf",e.vmAddress&&void 0!==e.vmAddress.balance),d.Fb(1),d.pc("ngIf",!e.vmAddress||null==e.vmAddress.balance),d.Fb(3),d.Kc("",d.lc(12,19,"SEND_SINGLE.FEE"),":"),d.Fb(2),d.pc("ngIf",e.platform.is("mobile")),d.Fb(1),d.Kc(" ",d.mc(15,21,e.gas*e.gasPriceSatoshi,8)," ETP"),d.Fb(2),d.pc("ngIf",e.vmAddress.balance/1e10<e.gas*e.gasPriceSatoshi),d.Fb(4),d.pc("ngClass",d.uc(24,D,!e.validRecipientAddress,e.validRecipientAddress)),d.Fb(2),d.pc("ngModel",e.recipientAddress),d.Fb(2),d.pc("ngIf",e.isMobile),d.Fb(1),d.pc("ngClass",d.uc(27,D,!e.validQuantity(e.quantity),e.validQuantity(e.quantity))),d.Fb(2),d.pc("ngModel",e.quantity),d.Fb(3),d.pc("ngIf",e.tickers&&e.tickers[e.selectedAsset]&&e.tickers[e.selectedAsset][e.base]),d.Fb(1),d.pc("ngIf",e.countDecimals(e.quantity)>e.decimals),d.Fb(4),d.pc("ngModel",e.showAdvanced),d.Fb(1),d.pc("ngIf",e.showAdvanced)}}const w=[{path:":symbol",component:(()=>{class e{constructor(e,t,i,n,s,a,c,r,o){this.metaverseService=e,this.walletService=t,this.appService=i,this.router=n,this.alertService=s,this.location=a,this.platform=c,this.vmService=r,this.modalCtrl=o,this.selectedAsset="ETP",this.quantity="",this.message="",this.showAdvanced=!1,this.tickers={},this.vmAddress={},this.validRecipientAddress=!1,this.fiatValue=e=>parseFloat(e)*this.tickers[this.selectedAsset][this.base].price||0,this.validQuantity=e=>void 0!==e&&this.countDecimals(e)<=this.decimals&&e>0&&this.vmAddress.balance>=Math.round(parseFloat(e)*Math.pow(10,this.decimals))+this.gas*this.gasPriceSatoshi*Math.pow(10,10),this.validGas=e=>void 0!==e&&0===this.countDecimals(e)&&e>=this.appService.default_fees_vm.gas,this.validGasPrice=e=>void 0!==e&&0===this.countDecimals(e)&&e>=this.appService.default_fees_vm.gasPrice/Math.pow(10,10),this.validForm=()=>this.validQuantity(this.quantity)&&this.validRecipientAddress}ngOnInit(){this.init()}init(){return Object(r.a)(this,void 0,void 0,(function*(){this.selectedAsset="ETP",this.quantity="",this.showAdvanced=!1,this.decimals=18,this.recipientAddress="",this.isMobile=this.walletService.isMobile(),this.gas=this.appService.default_fees_vm.gas,this.gasPriceSatoshi=this.appService.default_fees_vm.gasPrice/Math.pow(10,10),this.validRecipientAddress=!1;const e=yield this.walletService.getVmAddresses();e&&e.length&&e[0]?!1===(yield this.validAddress(e[0].address))?(this.alertService.showMessage("SWAP.INVALID_VM_ADDRESS.TITLE","SWAP.INVALID_VM_ADDRESS.SUBTITLE",""),this.router.navigate(["account","portfolio"])):(this.vmAddress=e[0],this.vmAddress.balance=yield this.vmService.balanceOf(this.vmAddress.address),console.log(yield this.validAddress(this.vmAddress.address)),this.loadTickers()):(this.alertService.showMessage("SWAP.NO_VM_ADDRESS.TITLE","SWAP.NO_VM_ADDRESS.SUBTITLE",""),this.router.navigate(["account","identities","generate-vm-address"]))}))}loadTickers(){return Object(r.a)(this,void 0,void 0,(function*(){[this.base,this.tickers]=yield this.metaverseService.getBaseAndTickers()}))}countDecimals(e){return Math.floor(e)!==e&&e.toString().split(".").length>1&&e.toString().split(".")[1].length||0}scan(){return Object(r.a)(this,void 0,void 0,(function*(){const e=yield this.modalCtrl.create({component:o.a,showBackdrop:!1,backdropDismiss:!1});e.onWillDismiss().then(t=>{if(t.data&&t.data.text){const e=t.data.text.toString().toString().split("&");this.validAddress(e[0])?(this.recipientAddress=e[0],this.recipientAddressInput.setFocus()):this.alertService.showMessage("SCAN.INVALID_ADDRESS.TITLE","SCAN.INVALID_ADDRESS.SUBTITLE","")}e.remove()}),yield e.present()}))}sendAll(){return Object(r.a)(this,void 0,void 0,(function*(){(yield this.alertService.alertConfirm("SEND_SINGLE.ALL.TITLE","SEND_SINGLE.ALL.SUBTITLE","SEND_SINGLE.ALL.CANCEL","SEND_SINGLE.ALL.OK"))&&(this.quantity=parseFloat(((this.vmAddress.balance-this.gas*this.gasPriceSatoshi*Math.pow(10,10))/Math.pow(10,this.decimals)).toFixed(this.decimals)+"")+"",this.quantityInput.setFocus())}))}send(){return Object(r.a)(this,void 0,void 0,(function*(){try{const e=yield this.vmService.sendParams(this.recipientAddress,this.quantity);this.alertService.stopLoading(),this.router.navigate(["account","confirm-vm"],{state:{data:{params:e}}})}catch(e){switch(console.error(e),this.alertService.stopLoading(),e.message){case"ERR_INSUFFICIENT_BALANCE":this.alertService.showError("SEND.MESSAGE.INSUFFICIENT_BALANCE","");break;case"ERR_TOO_MANY_INPUTS":this.alertService.showErrorTranslated("SEND.MESSAGE.ERROR_TOO_MANY_INPUTS","SEND.MESSAGE.ERROR_TOO_MANY_INPUTS_TEXT");break;default:this.alertService.showError("SEND.MESSAGE.CREATE_TRANSACTION",e.message)}}}))}cancel(){this.location.back()}validAddress(e){return this.walletService.validWeb3Address(e)}recipientChanged(){return Object(r.a)(this,void 0,void 0,(function*(){this.recipientAddress&&(this.recipientAddress=this.recipientAddress.trim()),this.validRecipientAddress=yield this.validAddress(this.recipientAddress)}))}}return e.\u0275fac=function(t){return new(t||e)(d.Rb(l.a),d.Rb(b.a),d.Rb(u.a),d.Rb(c.h),d.Rb(h.a),d.Rb(n.i),d.Rb(a.eb),d.Rb(p.a),d.Rb(a.bb))},e.\u0275cmp=d.Lb({type:e,selectors:[["app-send-vm"]],viewQuery:function(e,t){var i;1&e&&(d.Nc(A,!0),d.Nc(f,!0)),2&e&&(d.xc(i=d.gc())&&(t.recipientAddressInput=i.first),d.xc(i=d.gc())&&(t.quantityInput=i.first))},decls:11,vars:6,consts:[["slot","start"],["name","dots",4,"ngIf"],[4,"ngIf"],["name","dots"],[1,"available"],["class","balance-spinner","name","dots",4,"ngIf"],[1,"right"],["align","center","class","wrong-input","translate","SEND.NOTICE_TRANSACTION_FEE_UNCOVERED",4,"ngIf"],[3,"ngSubmit","keyup.enter"],["sendForm","ngForm"],[3,"ngClass"],["color","primary","position","floating","translate","SEND_SINGLE.RECIPIENT_ADDRESS"],["name","recipient_address","required","",3,"ngModel","ngModelChange"],["recipientAddressInput",""],["slot","end","class","scanButton",3,"click",4,"ngIf"],["color","primary","position","floating","translate","SEND_SINGLE.AMOUNT"],["name","quantity","type","number","min","0","required","",3,"ngModel","ngModelChange"],["quantityInput",""],["slot","end","type","button","fill","outline","shape","round","id","sendAll","translate","SEND_SINGLE.BUTTON.SEND_ALL",3,"click"],["class","advice",4,"ngIf"],["lines","none","class","wrong-input","translate","SEND.TOO_MANY_DECIMALS",4,"ngIf"],[1,"toggle-input"],["translate","SEND_SINGLE.SHOW_ADVANCED"],["name","showAdvanced","checked","false",3,"ngModel","ngModelChange"],["color","danger","expand","full","fill","outline","shape","round",3,"click"],["slot","start","name","close"],["translate","SEND_SINGLE.BUTTON.CANCEL"],["type","submit","expand","full","color","primary","fill","outline","shape","round"],["slot","start","disabled","checked","name","cog"],["translate","SEND_SINGLE.BUTTON.NEXT"],["name","dots",1,"balance-spinner"],["align","center","translate","SEND.NOTICE_TRANSACTION_FEE_UNCOVERED",1,"wrong-input"],["slot","end",1,"scanButton",3,"click"],["slot","icon-only","name","qr-code"],[1,"advice"],["lines","none","translate","SEND.TOO_MANY_DECIMALS",1,"wrong-input"],["color","primary","position","floating","translate","SEND_VM.GAS_PRICE"],["name","gasPrice","type","number","min","0","required","",3,"ngModel","ngModelChange"],["color","primary","position","floating","translate","SEND_VM.GAS"],["name","gas","type","number","min","0","required","",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(d.Xb(0,"ion-header"),d.Xb(1,"ion-toolbar"),d.Xb(2,"ion-buttons",0),d.Sb(3,"ion-back-button"),d.Wb(),d.Xb(4,"ion-title"),d.Ic(5),d.kc(6,"translate"),d.Wb(),d.Wb(),d.Wb(),d.Xb(7,"ion-content"),d.Sb(8,"br"),d.Gc(9,m,1,0,"ion-spinner",1),d.Gc(10,C,46,30,"div",2),d.Wb()),2&e&&(d.Fb(5),d.Lc("",t.selectedAsset," ",d.lc(6,4,"SEND_VM.TITLE"),""),d.Fb(4),d.pc("ngIf",!t.vmAddress),d.Fb(1),d.pc("ngIf",t.vmAddress&&t.vmAddress.address))},directives:[a.u,a.X,a.j,a.f,a.g,a.V,a.r,n.m,a.R,a.K,a.q,s.p,s.j,s.k,a.A,a.x,n.k,a.z,S.a,a.w,a.hb,s.n,s.i,s.l,a.db,a.i,a.W,a.c,a.v],pipes:[S.d,g.a,n.f],styles:["#sendAll[_ngcontent-%COMP%]{height:34px;margin-top:20px}.balance-spinner[_ngcontent-%COMP%]{margin-left:0;height:15px;top:3px}"]}),e})()}];let F=(()=>{class e{}return e.\u0275mod=d.Pb({type:e}),e.\u0275inj=d.Ob({factory:function(t){return new(t||e)},imports:[[c.j.forChild(w)],c.j]}),e})();var W=i("iTUp");let X=(()=>{class e{}return e.\u0275mod=d.Pb({type:e}),e.\u0275inj=d.Ob({factory:function(t){return new(t||e)},imports:[[n.c,s.e,a.Y,S.c.forChild(),W.a,F]]}),e})()},iTUp:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n=i("ofXK"),s=i("fXoL");let a=(()=>{class e{}return e.\u0275mod=s.Pb({type:e}),e.\u0275inj=s.Ob({factory:function(t){return new(t||e)},imports:[[n.c]]}),e})()},q5gJ:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("fXoL");let s=(()=>{class e{transform(e,t){return(e/Math.pow(10,t)).toLocaleString(void 0,{maximumFractionDigits:t})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=n.Qb({name:"format",type:e,pure:!0}),e})()}}]);