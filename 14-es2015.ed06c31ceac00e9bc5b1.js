(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"/ldR":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const i=n("Xe4H"),s=n("QVnb");class r extends i.MetaverseRequest{constructor({version:t=1,network:e="mainnet",source:n="",target:i="",sourceSignature:s="",callback:r="",time:o=0,timeout:a=0,targetSignature:c=""}){super(t,e),this.type="auth",this.source=n,this.target=i,this.sourceSignature=s,this.targetSignature=c,this.callback=r,this.time=o,this.timeout=a}validateSource(t,e){}encodeBuffer(){return t.concat([super.encodeBuffer(i.REQUEST_TYPE_AUTH),s.encodeVarStr(this.source),s.encodeVarStr(this.target),s.encodeVarInt(this.time),s.encodeVarInt(this.timeout),s.encodeVarStr(this.callback),s.encodeVarStr(this.sourceSignature,"hex"),s.encodeVarStr(this.targetSignature,"hex")])}static decodeBuffer(t,e,n,i={offset:0}){if(1!==t)throw Error("Unsupported request version");return new r({version:t,network:e,source:s.decodeVarStr(n,i),target:s.decodeVarStr(n,i),time:s.decodeVarInt(n,i),timeout:s.decodeVarInt(n,i),callback:s.decodeVarStr(n,i),sourceSignature:s.decodeVarStr(n,i,"hex"),targetSignature:s.decodeVarStr(n,i,"hex")})}}e.AuthRequest=r}).call(this,n("HDXh").Buffer)},"0ZLj":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const i=n("/ldR"),s=n("Xe4H"),r=n("QVnb");e.Request=class{constructor(t){switch(t.type){case"auth":return new i.AuthRequest(t);default:throw Error("Unsupported type")}}static decode(e,n="hex"){return this.decodeBuffer(t.from(e,n))}static decodeBuffer(t){const e={offset:0},n=r.decodeVarInt(t,e);let o="custom";switch(r.decodeVarInt(t,e)){case 1:o="mainnet";break;case 2:o="testnet";break;case 0:break;default:throw Error("Illegal network")}switch(r.decodeVarInt(t,e)){case s.REQUEST_TYPE_AUTH:return i.AuthRequest.decodeBuffer(n,o,t,e);default:throw Error("Unsupported type")}}}}).call(this,n("HDXh").Buffer)},"7BdR":function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return M}));var i=n("mrSG"),s=n("Ej91"),r=n("LvDl"),o=n("fXoL"),a=n("tyNb"),c=n("OaWH"),h=n("BZA/"),l=n("ofXK"),u=n("Fvwb"),f=n("onos"),d=n("3LUQ"),b=n("TEn/"),g=n("sYmb"),I=n("3Pt+"),p=n("z+xu");const E=["selectAvatar"];function S(t,e){if(1&t&&(o.Xb(0,"ion-select-option",11),o.Ic(1),o.Wb()),2&t){const t=e.$implicit;o.qc("value",t),o.Fb(1),o.Jc(t)}}function m(t,e){if(1&t){const t=o.Yb();o.Xb(0,"ion-item"),o.Xb(1,"ion-label",7),o.Ic(2),o.kc(3,"translate"),o.Wb(),o.Xb(4,"ion-select",8,9),o.fc("ngModelChange",(function(e){return o.Ac(t),o.jc().avatar=e}))("ionChange",(function(){o.Ac(t);const e=o.jc();return e.onAvatarSelectChange(e.avatar)})),o.kc(6,"translate"),o.kc(7,"translate"),o.Gc(8,S,2,2,"ion-select-option",10),o.Wb(),o.Wb()}if(2&t){const t=o.jc();o.Fb(2),o.Jc(o.lc(3,5,"BITIDENT.CONFIRM.SELECT_AVATAR")),o.Fb(2),o.qc("okText",o.lc(6,7,"OK")),o.qc("cancelText",o.lc(7,9,"CANCEL")),o.pc("ngModel",t.avatar),o.Fb(4),o.pc("ngForOf",t.avatars)}}const T=function(t){return{seconds:t}};function v(t,e){if(1&t&&(o.Xb(0,"div"),o.Xb(1,"ion-row"),o.Xb(2,"ion-col"),o.Sb(3,"ion-item",36),o.Wb(),o.Xb(4,"ion-col",16),o.Xb(5,"ion-item",17),o.Xb(6,"span"),o.Ic(7),o.Wb(),o.Wb(),o.Wb(),o.Wb(),o.Xb(8,"ion-row"),o.Xb(9,"ion-col"),o.Sb(10,"ion-item",37),o.Wb(),o.Xb(11,"ion-col",16),o.Xb(12,"ion-item",17),o.Ic(13),o.kc(14,"date"),o.Wb(),o.Wb(),o.Wb(),o.Xb(15,"ion-row"),o.Xb(16,"ion-col"),o.Sb(17,"ion-item",38),o.Wb(),o.Xb(18,"ion-col",16),o.Sb(19,"ion-item",39),o.Wb(),o.Wb(),o.Wb()),2&t){const t=o.jc(2);o.Fb(7),o.Jc(t.verifiedToken.callback),o.Fb(6),o.Jc(o.mc(14,3,1e3*t.verifiedToken.time,"medium")),o.Fb(6),o.pc("translateParams",o.tc(6,T,t.verifiedToken.timeout))}}function w(t,e){1&t&&o.Sb(0,"ion-icon",40)}function N(t,e){1&t&&o.Sb(0,"ion-icon",41)}function R(t,e){1&t&&o.Sb(0,"span",42)}function A(t,e){1&t&&o.Sb(0,"span",43)}function y(t,e){if(1&t){const t=o.Yb();o.Xb(0,"ion-item"),o.Sb(1,"ion-label",44),o.Xb(2,"ion-checkbox",45),o.fc("ngModelChange",(function(e){return o.Ac(t),o.jc(2).noSigAgreed=e})),o.Wb(),o.Wb()}if(2&t){const t=o.jc(2);o.Fb(2),o.pc("ngModel",t.noSigAgreed)}}const D=function(t){return{leftTime:t}},k=function(t){return{"error-border":t}};function O(t,e){if(1&t){const t=o.Yb();o.Xb(0,"form",12,13),o.fc("ngSubmit",(function(){o.Ac(t);const e=o.jc();return e.signAndSend(e.passphrase)})),o.Xb(2,"ion-card",14),o.Xb(3,"ion-grid"),o.Xb(4,"ion-row"),o.Xb(5,"ion-col"),o.Sb(6,"ion-item",15),o.Wb(),o.Xb(7,"ion-col",16),o.Xb(8,"ion-item",17),o.Ic(9),o.Wb(),o.Wb(),o.Wb(),o.Xb(10,"ion-row"),o.Xb(11,"ion-col"),o.Sb(12,"ion-item",18),o.Wb(),o.Xb(13,"ion-col",16),o.Xb(14,"ion-item",17),o.Ic(15),o.Wb(),o.Wb(),o.Wb(),o.Xb(16,"ion-row"),o.Xb(17,"ion-col"),o.Sb(18,"ion-item",19),o.Wb(),o.Xb(19,"ion-col",16),o.Xb(20,"ion-item",17),o.Ic(21),o.Wb(),o.Wb(),o.Wb(),o.Xb(22,"ion-row"),o.Xb(23,"ion-col"),o.Sb(24,"ion-item",20),o.Wb(),o.Xb(25,"ion-col",16),o.Xb(26,"ion-item",17),o.Xb(27,"countdown",21),o.Ic(28,"$!m!:$!s!"),o.Wb(),o.Wb(),o.Wb(),o.Wb(),o.Gc(29,v,20,8,"div",5),o.Xb(30,"ion-row"),o.Xb(31,"ion-col"),o.Xb(32,"ion-button",22),o.fc("click",(function(){o.Ac(t);const e=o.jc();return e.showDetails=!e.showDetails})),o.Gc(33,w,1,0,"ion-icon",23),o.Gc(34,N,1,0,"ion-icon",24),o.Gc(35,R,1,0,"span",25),o.Gc(36,A,1,0,"span",26),o.Wb(),o.Wb(),o.Wb(),o.Wb(),o.Wb(),o.Xb(37,"ion-item",27),o.Sb(38,"ion-label",28),o.Xb(39,"ion-input",29),o.fc("ngModelChange",(function(e){return o.Ac(t),o.jc().passphrase=e})),o.Wb(),o.Wb(),o.Sb(40,"br"),o.Gc(41,y,3,1,"ion-item",5),o.Xb(42,"ion-row"),o.Xb(43,"ion-col"),o.Xb(44,"ion-button",30),o.fc("click",(function(){return o.Ac(t),o.jc().cancel()})),o.Sb(45,"ion-icon",31),o.Sb(46,"span",32),o.Wb(),o.Wb(),o.Xb(47,"ion-col"),o.Xb(48,"ion-button",33),o.Sb(49,"ion-icon",34),o.Sb(50,"span",35),o.Wb(),o.Wb(),o.Wb(),o.Wb()}if(2&t){const t=o.yc(1),e=o.jc();o.Fb(9),o.Jc(e.verifiedToken.source),o.Fb(6),o.Jc(e.verifiedToken.target),o.Fb(6),o.Jc(e.hostname),o.Fb(6),o.pc("config",o.tc(13,D,e.leftTime)),o.Fb(2),o.pc("ngIf",e.showDetails),o.Fb(4),o.pc("ngIf",!e.showDetails),o.Fb(1),o.pc("ngIf",e.showDetails),o.Fb(1),o.pc("ngIf",!e.showDetails),o.Fb(1),o.pc("ngIf",e.showDetails),o.Fb(1),o.pc("ngClass",o.tc(15,k,!e.validPassword(e.passphrase))),o.Fb(2),o.pc("ngModel",e.passphrase),o.Fb(2),o.pc("ngIf",""==e.sourceSignature),o.Fb(7),o.pc("disabled",!t.form.valid||!e.validPassword(e.passphrase)||""==e.sourceSignature&&!e.noSigAgreed)}}let M=(()=>{class e{constructor(t,e,n,i,s,r,o){this.router=t,this.appService=e,this.metaverseService=n,this.location=i,this.wallet=s,this.bitident=r,this.alertService=o,this.avatar="",this.avatars=[],this.avatarsAddress={},this.showDetails=!1,this.passphrase="",this.noSigAgreed=!1,this.leftTime=0,this.validPassword=t=>t&&t.length>0,this.onAvatarSelectChange=t=>{this.verifiedToken.target=t}}ionViewDidEnter(){this.token=history.state.data?history.state.data.token:"",this.loadAvatars()}cancel(){this.router.navigate(["account","bitident"])}loadAvatars(){return this.metaverseService.listAvatars().then(t=>{0===t.length?this.alertService.showMessage("BITIDENT.MESSAGE.NO_AVATAR_TITLE","","BITIDENT.MESSAGE.NO_AVATAR_TITLE_BODY"):(t.forEach(t=>{this.avatarsAddress[t.symbol]=t.address,this.avatars.push(t.symbol)}),this.check(this.token))})}check(e){return Object(i.a)(this,void 0,void 0,(function*(){if(void 0===this.token||!Object(r.isString)(this.token)||0===this.token.trim().length)return this.location.back(),this.alertService.showError("BITIDENT.MESSAGE.TOKEN_MISSING","");yield this.alertService.showLoading();try{const n=s.Request.decode(e);if(this.sourceSignature=n.sourceSignature,n.version>1)this.location.back(),this.alertService.showError("BITIDENT.MESSAGE.HIGHER_VERSION","version "+n.version);else if(n.network!==this.appService.network)this.location.back(),this.alertService.showError("BITIDENT.MESSAGE.DIFFERENT_NETWORK",n.network);else if("auth"!==n.type)this.location.back(),this.alertService.showError("BITIDENT.MESSAGE.TYPE_NOT_SUPPORTED",n.type);else if(1e3*(n.time+n.timeout)<Date.now())this.location.back(),this.alertService.showError("BITIDENT.MESSAGE.TIMEOUT","");else if(n.target&&-1===this.avatars.indexOf(n.target))this.location.back(),this.alertService.showError("BITIDENT.MESSAGE.UNKNOWN_AVATAR",n.target);else{n.sourceSignature="";const e=n.encode("hex"),i=(yield this.metaverseService.getGlobalAvatar(n.source)).address;this.sourceSignature&&!s.Message.verify(e,i,t.from(this.sourceSignature,"hex"),n.source)?(this.location.back(),this.alertService.showError("BITIDENT.MESSAGE.WRONG_SIGNATURE",n.source)):(this.hostname=new URL(n.callback).hostname,this.verifiedToken=n,this.leftTime=n.time+n.timeout-Math.floor(Date.now())/1e3,this.verifiedToken.target||setTimeout(()=>this.selectAvatar.open(),100))}}catch(n){console.error(n),this.location.back(),this.alertService.showError("BITIDENT.MESSAGE.WRONG_INCOMING_DATA",n)}this.alertService.stopLoading()}))}signAndSend(t){return Object(i.a)(this,void 0,void 0,(function*(){try{yield this.alertService.showLoading();const e=yield this.wallet.getWallet(t),n=yield e.findDeriveNodeByAddess(this.avatarsAddress[this.verifiedToken.target],200),i=yield s.Message.signPK(this.verifiedToken.encode("hex"),n.keyPair.d.toBuffer(32),n.keyPair.compressed,this.verifiedToken.target);this.verifiedToken.targetSignature=i.toString("hex"),this.verifiedToken.sourceSignature=this.sourceSignature,yield this.bitident.confirm(this.verifiedToken.callback,this.verifiedToken.encode("hex")),this.alertService.stopLoading(),this.router.navigate(["account","portfolio"]),this.alertService.showMessage("BITIDENT.MESSAGE.SIGNIN_SUCCESSFUL_TITLE","BITIDENT.MESSAGE.SIGNIN_SUCCESSFUL_BODY","")}catch(e){if(this.alertService.stopLoading(),e.message)switch(console.error(e.message),e.message){case"ERR_DECRYPT_WALLET":this.alertService.showError("BITIDENT.MESSAGE.PASSWORD_WRONG","");break;case"EXPIRED":this.alertService.showError("BITIDENT.MESSAGE.EXPIRED","");break;case"ERR_AUTH":this.alertService.showError("BITIDENT.MESSAGE.SEND_SIG_ERROR","");break;case"ERR_INVALID_SIGNATURE":this.alertService.showError("BITIDENT.MESSAGE.SEND_INVALID_SIGNATURE","");break;default:throw this.alertService.showError("BITIDENT.MESSAGE.SIGN",e.message),Error("ERR_AUTH")}}}))}}return e.\u0275fac=function(t){return new(t||e)(o.Rb(a.h),o.Rb(c.a),o.Rb(h.a),o.Rb(l.i),o.Rb(u.a),o.Rb(f.a),o.Rb(d.a))},e.\u0275cmp=o.Lb({type:e,selectors:[["app-confirm"]],viewQuery:function(t,e){var n;1&t&&o.Nc(E,!0),2&t&&o.xc(n=o.gc())&&(e.selectAvatar=n.first)},inputs:{token:"token"},decls:12,vars:2,consts:[["slot","start"],["defaultHref","/bitident"],["translate","BITIDENT.CONFIRM.TITLE"],[1,"top-info"],["align","center","translate","BITIDENT.CONFIRM.INFORMATION"],[4,"ngIf"],["lines","none",3,"ngSubmit",4,"ngIf"],["color","primary","floating",""],["name","avatar","multiple","false",3,"ngModel","okText","cancelText","ngModelChange","ionChange"],["selectAvatar",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["lines","none",3,"ngSubmit"],["signForm","ngForm"],["size","12","size-lg","6"],["lines","none","translate","BITIDENT.CONFIRM.VERIFY_SOURCE"],[1,"right"],["lines","none"],["lines","none","translate","BITIDENT.CONFIRM.VERIFY_AVATAR"],["lines","none","translate","BITIDENT.CONFIRM.VERIFY_HOST"],["lines","none","translate","BITIDENT.CONFIRM.VERIFY_REMAINING_TIME"],[3,"config"],[1,"right-buttons",3,"click"],["slot","start","name","arrow-down",4,"ngIf"],["slot","start","name","arrow-up",4,"ngIf"],["translate","BITIDENT.CONFIRM.SHOW_DETAILS",4,"ngIf"],["translate","BITIDENT.CONFIRM.HIDE_DETAILS",4,"ngIf"],[3,"ngClass"],["color","primary","position","floating","translate","BITIDENT.CONFIRM.PASSWORD"],["name","passphrase","type","password","required","",3,"ngModel","ngModelChange"],["color","danger","expand","full","fill","outline","shape","round",3,"click"],["slot","start","name","close"],["translate","BITIDENT.CONFIRM.BUTTON.CANCEL"],["type","submit","expand","full","fill","outline","shape","round","color","primary",3,"disabled"],["slot","start","name","send"],["translate","BITIDENT.CONFIRM.BUTTON.NEXT"],["lines","none","translate","BITIDENT.CONFIRM.VERIFY_CALLBACK"],["lines","none","translate","BITIDENT.CONFIRM.VERIFY_TIME_OF_REQUEST"],["lines","none","translate","BITIDENT.CONFIRM.VERIFY_REQUEST_DURATION"],["lines","none","translate","BITIDENT.CONFIRM.VERIFY_REQUEST_DURATION_VALUE",3,"translateParams"],["slot","start","name","arrow-down"],["slot","start","name","arrow-up"],["translate","BITIDENT.CONFIRM.SHOW_DETAILS"],["translate","BITIDENT.CONFIRM.HIDE_DETAILS"],["id","disclaimer-agree-label","text-wrap","","translate","BITIDENT.CONFIRM.NO_SIG_AGREE"],["name","no_sig_agreed","id","no-sig-agree",3,"ngModel","ngModelChange"]],template:function(t,e){1&t&&(o.Xb(0,"ion-header"),o.Xb(1,"ion-toolbar"),o.Xb(2,"ion-buttons",0),o.Sb(3,"ion-back-button",1),o.Wb(),o.Sb(4,"ion-title",2),o.Wb(),o.Wb(),o.Xb(5,"ion-content"),o.Xb(6,"ion-grid"),o.Xb(7,"ion-row",3),o.Xb(8,"ion-col"),o.Sb(9,"p",4),o.Wb(),o.Wb(),o.Gc(10,m,9,11,"ion-item",5),o.Gc(11,O,51,17,"form",6),o.Wb(),o.Wb()),2&t&&(o.Fb(10),o.pc("ngIf",e.verifiedToken&&!e.verifiedToken.target),o.Fb(1),o.pc("ngIf",e.verifiedToken&&e.verifiedToken.target))},directives:[b.u,b.X,b.j,b.f,b.g,b.V,g.a,b.r,b.t,b.K,b.q,l.m,b.x,b.z,b.N,b.gb,I.i,I.l,l.l,b.O,I.p,I.j,I.k,b.k,p.a,b.i,l.k,b.w,b.hb,I.n,b.v,b.p,b.c],pipes:[g.d,l.e],styles:["ion-item[_ngcontent-%COMP%]{--min-height:16px}"]}),e})()}).call(this,n("HDXh").Buffer)},Ej91:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n("0ZLj");e.Request=i.Request;const s=n("Z8qY");e.Message=s.Message},EyXv:function(t,e,n){"use strict";n.r(e),n.d(e,"ConfirmPageModule",(function(){return d}));var i=n("ofXK"),s=n("3Pt+"),r=n("TEn/"),o=n("tyNb"),a=n("7BdR"),c=n("fXoL");const h=[{path:"",component:a.a}];let l=(()=>{class t{}return t.\u0275mod=c.Pb({type:t}),t.\u0275inj=c.Ob({factory:function(e){return new(e||t)},imports:[[o.j.forChild(h)],o.j]}),t})();var u=n("sYmb"),f=n("z+xu");let d=(()=>{class t{}return t.\u0275mod=c.Pb({type:t}),t.\u0275inj=c.Ob({factory:function(e){return new(e||t)},imports:[[i.c,s.e,r.Y,f.b,u.c.forChild(),l]]}),t})()},QVnb:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const i=n("nU2i");function s(t){return i.encode(t)}function r(t,e={offset:0}){const n=i.decode(t,e.offset);return e.offset+=s(n).length,n}e.encodeVarStr=function(e,n="utf-8"){const s=t.from(e,n);return t.concat([i.encode(s.length),s])},e.decodeVarStr=function(e,n={offset:0},i="utf-8"){const s=r(e,n),o=e.slice(n.offset,n.offset+s).toString(i);return n.offset+=t.from(o,i).length,o},e.encodeVarInt=s,e.decodeVarInt=r}).call(this,n("HDXh").Buffer)},Xe4H:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const i=n("QVnb");e.REQUEST_TYPE_AUTH=1,e.MetaverseRequest=class{constructor(t,e){this.version=t,this.network=e}encodeBuffer(e){return t.concat([i.encodeVarInt(this.version),i.encodeVarInt(this.getNetworkId()),i.encodeVarInt(e)])}encode(t="buffer"){const e=this.encodeBuffer();return"buffer"!==t?e.toString(t):e}getNetworkId(){switch(this.network){case"mainnet":return 1;case"testnet":return 2}return 0}}}).call(this,n("HDXh").Buffer)},Z8qY:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const i=n("p0sm");var s=n("b3gk"),r=n("IzB8"),o=n("pQ88");e.Message=class{static encodeSignature(e,n,i){return i&&(n+=4),t.concat([t.alloc(1,n+27),e])}static decodeSignature(t){if(65!==t.length)throw new Error("Invalid signature length");var e=t.readUInt8(0)-27;if(e>7)throw new Error("Invalid signature parameter");return{compressed:!!(4&e),recovery:3&e,signature:t.slice(1)}}static verify(e,n,o,a="Metaverse"){t.isBuffer(o)||(o=t.from(o,"hex"));var c=this.decodeSignature(o),h=i.magicHash(e,`\x18${a} Signed Message:\n`),l=r.recover(h,c.signature,c.recovery,c.compressed),u=i.hash160(l),f=s.decode(n).slice(1);return t.isBuffer(f)||(f=t.from(f,"hex")),0==t.compare(u,f)}static signWIF(t,e,n="Metaverse"){const i=o.decode(e);return this.signPK(t,i.privateKey,i.compressed,n)}static signPK(t,e,n,s="Metaverse"){var o=i.magicHash(t,`\x18${s} Signed Message:\n`),a=r.sign(o,e);return this.encodeSignature(a.signature,a.recovery,n)}}}).call(this,n("HDXh").Buffer)},onos:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n("fXoL"),s=n("tk/3");let r=(()=>{class t{constructor(t){this.http=t}confirm(t,e){return this.http.post(t,{token:e}).toPromise().catch(t=>{throw console.error(t._body),Error(t._body)})}}return t.\u0275fac=function(e){return new(e||t)(i.bc(s.a))},t.\u0275prov=i.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},p0sm:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=n("mObS"),s=n("nU2i");function r(t){return i("sha256").update(t).digest()}function o(t){return r(r(t))}e.sha256=r,e.hash256=o,e.hash160=function(t){return i("ripemd160").update(r(t)).digest()},e.magicHash=function(e,n){t.isBuffer(n=n||"\x18Metaverse Signed Message:\n")||(n=t.from(n,"utf8"));var i=s.encodingLength(e.length),r=t.allocUnsafe(n.length+i+e.length);return n.copy(r,0),s.encode(e.length,r,n.length),r.write(e,n.length+i),o(r)}}).call(this,n("HDXh").Buffer)},"z+xu":function(t,e,n){"use strict";n.d(e,"a",(function(){return u})),n.d(e,"b",(function(){return f}));var i=n("fXoL"),s=n("ofXK");function r(t,e){if(1&t&&(i.Vb(0),i.Sb(1,"span",2),i.Ub()),2&t){const t=i.jc();i.Fb(1),i.pc("innerHTML",t.i.text,i.Bc)}}function o(t,e){1&t&&i.Tb(0)}const a=function(t){return{$implicit:t}};var c=function(t){return t[t.ing=0]="ing",t[t.pause=1]="pause",t[t.stop=2]="stop",t[t.done=3]="done",t}({});let h=(()=>{class t{constructor(t){this.ngZone=t,this.fns=[],this.commands=[],this.ing=!1}start(){!0!==this.ing&&(this.ing=!0,this.nextTime=+new Date,this.ngZone.runOutsideAngular(()=>{this.process()}))}process(){for(;this.commands.length;)this.commands.shift()();let t=+new Date-this.nextTime;const e=1+Math.floor(t/100);t=100-t%100,this.nextTime+=100*e;for(let n=0,i=this.fns.length;n<i;n+=2){let t=this.fns[n+1];if(0===t)this.fns[n](e);else{t+=2*e-1;const i=Math.floor(t/20);i>0&&this.fns[n](i),this.fns[n+1]=t%20+1}}this.ing&&setTimeout(()=>this.process(),t)}add(t,e){return this.commands.push(()=>{this.fns.push(t),this.fns.push(1e3===e?1:0),this.ing=!0}),this}remove(t){return this.commands.push(()=>{const e=this.fns.indexOf(t);-1!==e&&this.fns.splice(e,2),this.ing=this.fns.length>0}),this}}return t.\u0275fac=function(e){return new(e||t)(i.bc(i.E))},t.\u0275prov=i.Nb({token:t,factory:t.\u0275fac}),t})(),l=(()=>{class t{constructor(t){this.locale=t,this.demand=!1,this.leftTime=0,this.format="HH:mm:ss",this.timezone="+0000",this.formatDate=({date:t,formatStr:e,timezone:n})=>Object(s.s)(new Date(t),e,this.locale,n||this.timezone||"+0000")}}return t.\u0275fac=function(e){return new(e||t)(i.bc(i.y))},t.\u0275prov=Object(i.Nb)({factory:function(){return new t(Object(i.bc)(i.y))},token:t,providedIn:"root"}),t})(),u=(()=>{class t{constructor(t,e,n,s,r){this.locale=t,this.timer=e,this.defCog=n,this.cdr=s,this.ngZone=r,this.frequency=1e3,this._notify={},this.status=c.ing,this.isDestroy=!1,this.i={},this.left=0,this.event=new i.q}begin(){this.status=c.ing,this.callEvent("start")}restart(){this.status!==c.stop&&this.destroy(),this.init(),this.callEvent("restart")}stop(){this.status!==c.stop&&(this.status=c.stop,this.destroy(),this.callEvent("stop"))}pause(){this.status!==c.stop&&this.status!==c.pause&&(this.status=c.pause,this.callEvent("pause"))}resume(){this.status!==c.stop&&this.status===c.pause&&(this.status=c.ing,this.callEvent("resume"))}callEvent(t){this.event.emit({action:t,left:this.left,status:this.status,text:this.i.text})}init(){const{locale:t,defCog:e}=this,n=this.config=Object.assign(Object.assign(Object.assign({},new l(t)),e),this.config),i=this.frequency=~n.format.indexOf("S")?100:1e3;this.status=n.demand?c.pause:c.ing,this.getLeft();const s=this.reflow;this.reflow=(t=0,e=!1)=>s.apply(this,[t,e]),Array.isArray(n.notify)&&n.notify.forEach(t=>{if(t<1)throw new Error("The notify config must be a positive integer.");t*=1e3,this._notify[t-=t%i]=!0}),this.timer.add(this.reflow,i).start(),this.reflow(0,!0)}destroy(){return this.timer.remove(this.reflow),this}reflow(t=0,e=!1){if(this.isDestroy)return;const{status:n,config:i,_notify:s}=this;if(!e&&n!==c.ing)return;const r=this.left=this.left-this.frequency*t;this.i={value:r,text:i.formatDate({date:r,formatStr:i.format,timezone:i.timezone})},"function"==typeof i.prettyText&&(this.i.text=i.prettyText(this.i.text)),this.cdr.detectChanges(),(0===i.notify||s[r])&&this.ngZone.run(()=>{this.callEvent("notify")}),r<1&&this.ngZone.run(()=>{this.status=c.done,this.callEvent("done"),this.destroy()})}getLeft(){const{config:t,frequency:e}=this;let n=1e3*t.leftTime;const i=t.stopTime;!n&&i&&(n=i-(new Date).getTime()),this.left=n-n%e}ngOnInit(){this.init(),this.config.demand||this.begin()}ngOnDestroy(){this.isDestroy=!0,this.destroy()}ngOnChanges(t){t.config.firstChange||this.restart()}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(i.y),i.Rb(h),i.Rb(l),i.Rb(i.i),i.Rb(i.E))},t.\u0275cmp=i.Lb({type:t,selectors:[["countdown"]],hostVars:2,hostBindings:function(t,e){2&t&&i.Jb("count-down",!0)},inputs:{config:"config",render:"render"},outputs:{event:"event"},features:[i.Db],decls:2,vars:5,consts:[[4,"ngIf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"innerHTML"]],template:function(t,e){1&t&&(i.Gc(0,r,2,1,"ng-container",0),i.Gc(1,o,1,0,"ng-container",1)),2&t&&(i.pc("ngIf",!e.render),i.Fb(1),i.pc("ngTemplateOutlet",e.render)("ngTemplateOutletContext",i.tc(3,a,e.i)))},directives:[s.m,s.n],encapsulation:2,changeDetection:0}),t})(),f=(()=>{class t{}return t.\u0275mod=i.Pb({type:t}),t.\u0275inj=i.Ob({factory:function(e){return new(e||t)},providers:[h],imports:[[s.c]]}),t})()}}]);