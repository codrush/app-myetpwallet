(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{"5El1":function(e,t,n){"use strict";n.r(t),n.d(t,"CreatePageModule",(function(){return M}));var a=n("ofXK"),s=n("3Pt+"),i=n("TEn/"),o=n("tyNb"),r=n("mrSG"),l=n("fXoL"),c=n("3LUQ"),b=n("BZA/"),d=n("sYmb"),A=n("q5gJ");function g(e,t){1&e&&l.Sb(0,"br")}function E(e,t){1&e&&l.Sb(0,"ion-item",34)}function h(e,t){1&e&&l.Sb(0,"ion-item",35)}function u(e,t){if(1&e&&(l.Xb(0,"ion-select-option",38),l.Ic(1),l.kc(2,"format"),l.Wb()),2&e){const e=t.$implicit;l.qc("value",e.address),l.Fb(1),l.Lc(" ",e.address," - ",l.mc(2,3,e.available,8)," ETP")}}function T(e,t){if(1&e){const e=l.Yb();l.Xb(0,"ion-select",36),l.fc("ngModelChange",(function(t){return l.Ac(e),l.jc().avatar_address=t})),l.kc(1,"translate"),l.kc(2,"translate"),l.Gc(3,u,3,6,"ion-select-option",37),l.Wb()}if(2&e){const e=l.jc();l.qc("okText",l.lc(1,5,"OK")),l.qc("cancelText",l.lc(2,7,"CANCEL")),l.pc("ngModel",e.avatar_address)("interfaceOptions",e.addressSelectOptions),l.Fb(3),l.pc("ngForOf",e.addressbalances)}}function f(e,t){1&e&&l.Sb(0,"ion-input",39)}function m(e,t){1&e&&l.Sb(0,"ion-item",40)}function _(e,t){1&e&&(l.Xb(0,"ion-item",41),l.Ic(1),l.kc(2,"translate"),l.Wb()),2&e&&(l.Fb(1),l.Kc("",l.lc(2,1,"MESSAGE_TOO_LONG")," "))}function R(e,t){if(1&e){const e=l.Yb();l.Xb(0,"div"),l.Sb(1,"br"),l.Xb(2,"ion-item",42),l.Sb(3,"ion-label",43),l.Wb(),l.Sb(4,"div",44),l.Xb(5,"ion-item",42),l.Sb(6,"span",45),l.Sb(7,"span",46),l.Wb(),l.Xb(8,"ion-item"),l.Xb(9,"ion-range",47),l.fc("ngModelChange",(function(t){return l.Ac(e),l.jc().bounty_fee=t})),l.Xb(10,"ion-label",48),l.Ic(11),l.Wb(),l.Xb(12,"ion-label",49),l.Ic(13),l.Wb(),l.Wb(),l.Wb(),l.Wb()}if(2&e){const e=l.jc();l.Fb(9),l.pc("ngModel",e.bounty_fee),l.Fb(2),l.Kc("",(100-e.bounty_fee)/100," ETP"),l.Fb(2),l.Kc("",e.bounty_fee/100," ETP")}}const p=function(e){return{"error-border":e}},S=function(e,t){return{"error-border":e,"valid-border":t}};class v{constructor(e,t){this.address=e,this.available=t}}const C=[{path:"",component:(()=>{class e{constructor(e,t,n,a,s,i){this.alertService=e,this.router=t,this.metaverseService=n,this.platform=a,this.translate=s,this.activatedRoute=i,this.symbol="",this.avatar_address="",this.addressbalances=[],this.message="",this.available_symbol=!1,this.showAdvanced=!1,this.validAddress=e=>""!=e,this.validSymbol=e=>e.length>2&&e.length<64&&!/[^A-Za-z0-9@_.-]/g.test(e)&&this.available_symbol,this.validMessageLength=e=>this.metaverseService.verifyMessageSize(e)<253,this.symbolChanged=e=>{e=e.trim(),this.symbol=e,e&&e.length>=3&&this.metaverseService.getAvatarAvailable(e).then(t=>{this.symbol===e&&(this.available_symbol=t)}).catch(e=>{this.available_symbol=!1})},this.avatar_address=this.activatedRoute.snapshot.params.address,Promise.all([this.metaverseService.getAddresses(),this.metaverseService.getAddressBalances()]).then(([e,t])=>{e.forEach(e=>{t[e]&&t[e].ETP&&t[e].ETP.available>=1e8&&""===t[e].AVATAR&&this.addressbalances.push(new v(e,t[e].ETP.available))})}),this.bounty_fee=80,this.default_bounty_fee=this.bounty_fee,this.total_fee=1e8,this.metaverseService.getFees().then(e=>{this.bounty_fee=e.bountyShare,this.default_bounty_fee=this.bounty_fee,this.total_fee=e.avatar})}ngOnInit(){this.translate.get("CREATE_AVATAR.ADDRESS_SUBTITLE").subscribe(e=>{this.addressSelectOptions={subHeader:e}})}create(){return this.alertService.showLoading().then(()=>{const e=[];return this.message&&e.push(this.message),this.metaverseService.createAvatarTx(this.avatar_address,this.symbol,void 0,this.showAdvanced?this.bounty_fee*this.total_fee/100:this.default_bounty_fee*this.total_fee/100,e)}).catch(e=>{switch(console.error(e),this.alertService.stopLoading(),e.message){case"ERR_CONNECTION":this.alertService.showError("SEND.MESSAGE.ERROR_SEND_TEXT","");break;case"ERR_BROADCAST":this.translate.get("SEND.MESSAGE.ONE_TX_PER_BLOCK").subscribe(e=>{this.alertService.showError("SEND.MESSAGE.BROADCAST_ERROR",e)});break;case"ERR_DECRYPT_WALLET":this.alertService.showError("MESSAGE.PASSWORD_WRONG","");break;case"ERR_INSUFFICIENT_BALANCE":this.alertService.showError("SEND.MESSAGE.INSUFFICIENT_BALANCE","");break;default:this.alertService.showError("SEND.MESSAGE.CREATE_TRANSACTION",e.message)}})}send(){this.create().then(e=>{const t=e.encode().toString("hex");this.router.navigate(["account","confirm"],{state:{data:{tx:t}}}),this.alertService.stopLoading()})}confirm(){return Object(r.a)(this,void 0,void 0,(function*(){(yield this.alertService.alertConfirm("CREATE_AVATAR.CONFIRMATION.TITLE","CREATE_AVATAR.CONFIRMATION.SUBTITLE","CREATE_AVATAR.CONFIRMATION.CANCEL","CREATE_AVATAR.CONFIRMATION.OK"))&&this.send()}))}}return e.\u0275fac=function(t){return new(t||e)(l.Rb(c.a),l.Rb(o.h),l.Rb(b.a),l.Rb(i.eb),l.Rb(d.e),l.Rb(o.a))},e.\u0275cmp=l.Lb({type:e,selectors:[["app-create"]],decls:54,vars:31,consts:[["slot","start"],["defaultHref","/account/identities"],["translate","CREATE_AVATAR.TITLE"],["align","center","translate","CREATE_AVATAR.INFORMATION"],[1,"right"],[4,"ngIf"],[2,"padding-bottom","0",3,"ngSubmit"],["sendForm","ngForm"],[2,"padding-bottom","0"],[3,"ngClass"],["color","primary","position","floating","translate","CREATE_AVATAR.NAME"],["name","symbol","maxlength","63","required","",3,"ngModel","ngModelChange"],["translate","CREATE_AVATAR.HELP.NAME",1,"advice"],["lines","none","class","wrong-input","translate","CREATE_AVATAR.NAME_TOO_SHORT",4,"ngIf"],["lines","none","class","wrong-input","translate","CREATE_AVATAR.AVATAR_ALREADY_EXIST",4,"ngIf"],["color","primary","position","floating","translate","CREATE_AVATAR.ADDRESS"],["name","avatar_address","multiple","false",3,"ngModel","okText","cancelText","interfaceOptions","ngModelChange",4,"ngIf"],["disabled","",4,"ngIf"],["translate","CREATE_AVATAR.HELP.ADDRESS",1,"advice"],["lines","none","class","wrong-input","translate","CREATE_AVATAR.NO_ADDRESS_1ETP",4,"ngIf"],["color","primary","position","floating"],["name","message",3,"ngModel","ngModelChange"],[1,"advice"],["lines","none","class","wrong-input",4,"ngIf"],[1,"toggle-input"],["translate","CREATE_AVATAR.SHOW_ADVANCED"],["name","showAdvanced","checked","false",3,"ngModel","ngModelChange"],[1,"padding-bottom"],["color","danger","expand","full","fill","outline","shape","round","routerLink","/avatar"],["slot","start","name","close"],["translate","CREATE_AVATAR.BUTTON.CANCEL"],["expand","full","type","submit","fill","outline","shape","round","color","primary",3,"disabled"],["slot","start","disabled","checked","name","cog"],["translate","CREATE_AVATAR.BUTTON.NEXT"],["lines","none","translate","CREATE_AVATAR.NAME_TOO_SHORT",1,"wrong-input"],["lines","none","translate","CREATE_AVATAR.AVATAR_ALREADY_EXIST",1,"wrong-input"],["name","avatar_address","multiple","false",3,"ngModel","okText","cancelText","interfaceOptions","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["disabled",""],["lines","none","translate","CREATE_AVATAR.NO_ADDRESS_1ETP",1,"wrong-input"],["lines","none",1,"wrong-input"],["lines","none"],["color","primary","translate","CREATE_AVATAR.BOUNTY_FEE"],["translate","CREATE_AVATAR.HELP.BOUNTY_FEE",1,"advice"],["translate","CREATE_AVATAR.BOUNTY_FEE_MINERS",1,"rangeTextLeft"],["translate","CREATE_AVATAR.BOUNTY_FEE_DEVELOPERS",1,"right"],["min","0","max","80","step","10","snaps","true","color","primary","name","bounty_fee",1,"bountyFeeRange",3,"ngModel","ngModelChange"],["range-left",""],["range-right","",1,"right"]],template:function(e,t){if(1&e&&(l.Xb(0,"ion-header"),l.Xb(1,"ion-toolbar"),l.Xb(2,"ion-buttons",0),l.Sb(3,"ion-back-button",1),l.Wb(),l.Sb(4,"ion-title",2),l.Wb(),l.Wb(),l.Xb(5,"ion-content"),l.Xb(6,"ion-row"),l.Xb(7,"ion-col"),l.Sb(8,"p",3),l.Wb(),l.Wb(),l.Xb(9,"ion-row"),l.Xb(10,"ion-col"),l.Xb(11,"p",4),l.Ic(12),l.kc(13,"translate"),l.Gc(14,g,1,0,"br",5),l.Ic(15," 1 ETP"),l.Wb(),l.Wb(),l.Wb(),l.Xb(16,"form",6,7),l.fc("ngSubmit",(function(){return t.confirm()})),l.Xb(18,"ion-list",8),l.Xb(19,"ion-item",9),l.Sb(20,"ion-label",10),l.Xb(21,"ion-input",11),l.fc("ngModelChange",(function(e){return t.symbol=e}))("ngModelChange",(function(){return t.symbolChanged(t.symbol)})),l.Wb(),l.Wb(),l.Sb(22,"div",12),l.Gc(23,E,1,0,"ion-item",13),l.Gc(24,h,1,0,"ion-item",14),l.Xb(25,"ion-item",9),l.Sb(26,"ion-label",15),l.Gc(27,T,4,9,"ion-select",16),l.Gc(28,f,1,0,"ion-input",17),l.Wb(),l.Sb(29,"div",18),l.Gc(30,m,1,0,"ion-item",19),l.Xb(31,"ion-item",9),l.Xb(32,"ion-label",20),l.Ic(33),l.kc(34,"translate"),l.Wb(),l.Xb(35,"ion-input",21),l.fc("ngModelChange",(function(e){return t.message=e})),l.Wb(),l.Wb(),l.Xb(36,"div",22),l.Ic(37),l.kc(38,"translate"),l.Wb(),l.Gc(39,_,3,3,"ion-item",23),l.Sb(40,"br"),l.Xb(41,"ion-item",24),l.Sb(42,"ion-label",25),l.Xb(43,"ion-toggle",26),l.fc("ngModelChange",(function(e){return t.showAdvanced=e})),l.Wb(),l.Wb(),l.Gc(44,R,14,3,"div",5),l.Wb(),l.Xb(45,"ion-row",27),l.Xb(46,"ion-col"),l.Xb(47,"ion-button",28),l.Sb(48,"ion-icon",29),l.Sb(49,"span",30),l.Wb(),l.Wb(),l.Xb(50,"ion-col"),l.Xb(51,"ion-button",31),l.Sb(52,"ion-icon",32),l.Sb(53,"span",33),l.Wb(),l.Wb(),l.Wb(),l.Wb(),l.Wb()),2&e){const e=l.yc(17);l.Fb(12),l.Kc("",l.lc(13,18,"FEE"),":"),l.Fb(2),l.pc("ngIf",t.platform.is("mobile")),l.Fb(5),l.pc("ngClass",l.tc(24,p,!t.validSymbol(t.symbol))),l.Fb(2),l.pc("ngModel",t.symbol),l.Fb(2),l.pc("ngIf",t.symbol.length>0&&t.symbol.length<3),l.Fb(1),l.pc("ngIf",t.symbol.length>=3&&!t.available_symbol),l.Fb(1),l.pc("ngClass",l.tc(26,p,!t.validAddress(t.avatar_address))),l.Fb(2),l.pc("ngIf",0!=t.addressbalances.length),l.Fb(1),l.pc("ngIf",0==t.addressbalances.length),l.Fb(2),l.pc("ngIf",0==t.addressbalances.length),l.Fb(1),l.pc("ngClass",l.uc(28,S,!t.validMessageLength(t.message),t.message.length>0&&t.validMessageLength(t.message))),l.Fb(2),l.Jc(l.lc(34,20,"CREATE_AVATAR.MESSAGE")),l.Fb(2),l.pc("ngModel",t.message),l.Fb(2),l.Jc(l.lc(38,22,"CREATE_AVATAR.HELP.MESSAGE")),l.Fb(2),l.pc("ngIf",!t.validMessageLength(t.message)),l.Fb(4),l.pc("ngModel",t.showAdvanced),l.Fb(1),l.pc("ngIf",t.showAdvanced),l.Fb(7),l.pc("disabled",!(e.form.valid&&t.validSymbol(t.symbol)&&t.validAddress(t.avatar_address)&&t.validMessageLength(t.message)))}},directives:[i.u,i.X,i.j,i.f,i.g,i.V,d.a,i.r,i.K,i.q,a.m,s.p,s.j,s.k,i.A,i.x,a.k,i.z,i.w,i.hb,s.f,s.n,s.i,s.l,i.W,i.c,i.i,i.fb,o.i,i.v,i.N,i.gb,a.l,i.O,i.G],pipes:[d.d,A.a],styles:[".uppercase[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-transform:uppercase}.bountyFeeRange[_ngcontent-%COMP%]   .range-slider[_ngcontent-%COMP%]{margin-right:20%}.bountyFeeRange.range-md[_ngcontent-%COMP%]   .range-bar[_ngcontent-%COMP%]:not(.range-bar-active){width:calc(125% + 25px)}.rangeTextLeft[_ngcontent-%COMP%]{padding:8px}"]}),e})()}];let O=(()=>{class e{}return e.\u0275mod=l.Pb({type:e}),e.\u0275inj=l.Ob({factory:function(t){return new(t||e)},imports:[[o.j.forChild(C)],o.j]}),e})();var y=n("iTUp");let M=(()=>{class e{}return e.\u0275mod=l.Pb({type:e}),e.\u0275inj=l.Ob({factory:function(t){return new(t||e)},imports:[[a.c,s.e,i.Y,d.c.forChild(),y.a,O]]}),e})()}}]);