(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{"4bAk":function(e,t,n){"use strict";n.r(t),n.d(t,"CreatePageModule",(function(){return M}));var a=n("ofXK"),i=n("3Pt+"),o=n("TEn/"),s=n("tyNb"),r=n("fXoL"),l=n("3LUQ"),c=n("sYmb"),b=n("BZA/"),d=n("q5gJ");function h(e,t){1&e&&r.Sb(0,"ion-item",31)}function g(e,t){1&e&&r.Sb(0,"ion-item",32)}function m(e,t){if(1&e&&(r.Xb(0,"ion-select-option",35),r.Ic(1),r.Wb()),2&e){const e=t.$implicit;r.qc("value",e.symbol),r.Fb(1),r.Jc(e.symbol)}}function f(e,t){if(1&e){const e=r.Yb();r.Xb(0,"ion-select",33),r.fc("ngModelChange",(function(t){return r.Ac(e),r.jc().recipient_avatar=t}))("ngModelChange",(function(){return r.Ac(e),r.jc().avatarChanged()})),r.kc(1,"translate"),r.kc(2,"translate"),r.Gc(3,m,2,2,"ion-select-option",34),r.Wb()}if(2&e){const e=r.jc();r.qc("okText",r.lc(1,4,"OK")),r.qc("cancelText",r.lc(2,6,"CANCEL")),r.pc("ngModel",e.recipient_avatar),r.Fb(3),r.pc("ngForOf",e.avatars)}}function p(e,t){if(1&e){const e=r.Yb();r.Xb(0,"ion-input",36),r.fc("ngModelChange",(function(t){return r.Ac(e),r.jc().no_avatar_placeholder=t})),r.Wb()}if(2&e){const e=r.jc();r.pc("ngModel",e.no_avatar_placeholder)}}function u(e,t){1&e&&r.Sb(0,"ion-item",37)}function E(e,t){if(1&e){const e=r.Yb();r.Xb(0,"div"),r.Xb(1,"ion-item",38),r.Sb(2,"ion-label",39),r.Xb(3,"ion-badge",40),r.Ic(4),r.kc(5,"format"),r.Wb(),r.Wb(),r.Xb(6,"ion-item"),r.Xb(7,"ion-range",41),r.fc("ngModelChange",(function(t){return r.Ac(e),r.jc().fee=t})),r.Xb(8,"ion-label",42),r.Ic(9),r.kc(10,"format"),r.Wb(),r.Xb(11,"ion-label",43),r.Ic(12),r.kc(13,"format"),r.Wb(),r.Wb(),r.Wb(),r.Wb()}if(2&e){const e=r.jc();r.Fb(4),r.Kc("",r.mc(5,4,e.fee,8)," ETP"),r.Fb(3),r.pc("ngModel",e.fee),r.Fb(2),r.Jc(r.mc(10,7,1e4,8)),r.Fb(3),r.Jc(r.mc(13,10,1e7,8))}}const v=function(e){return{fee:e}},_=function(e){return{"error-border":e}},T=[{path:"",component:(()=>{class e{constructor(e,t,n,a,i){this.alertService=e,this.platform=t,this.router=n,this.translate=a,this.metaverseService=i,this.symbol="",this.recipient_address=history.state.data&&history.state.data.avatar_address?history.state.data.avatar_address:"",this.recipient_avatar=history.state.data&&history.state.data.avatar_name?history.state.data.avatar_name:"",this.content="",this.no_avatar=!1,this.defaultFee=1e4,this.fee=1e5,this.symbol_available=!1,this.showAdvanced=!1,this.validSymbol=e=>/^[A-Za-z0-9._\-]{3,64}$/g.test(e)&&this.symbol_available,this.validContent=e=>void 0===e||e.length<253,this.validName=e=>void 0!==e&&e.length>0,this.validAddress=e=>void 0!==e&&e.length>0,this.avatarChanged=()=>{this.avatars.forEach(e=>{e.symbol!==this.recipient_avatar||(this.recipient_address=e.address)})},this.symbolChanged=()=>{this.symbol&&this.symbol.length>=3&&(this.symbol=this.symbol.trim(),Promise.all([this.metaverseService.suggestMIT(this.symbol),this.symbol]).then(e=>{if(this.symbol!==e[1])throw"";this.symbol_available=e[0][0]!==this.symbol}).catch(e=>{this.symbol_available=!1}))},this.recipient_address||this.translate.get("CREATE_MIT.SELECT_AVATAR").subscribe(e=>{this.recipient_address=e}),this.translate.get("CREATE_MIT.NO_AVATAR_PLACEHOLDER").subscribe(e=>{this.no_avatar_placeholder=e}),Promise.all([this.metaverseService.getAddressBalances(),this.metaverseService.listAvatars()]).then(e=>{this.avatars=e[1],0===this.avatars.length&&(this.no_avatar=!0);const t=e[0],n=[];Object.keys(t).length&&Object.keys(t).forEach(e=>{t[e].ETP&&t[e].ETP.available>=1e4&&(n.push({address:e,available:t[e].ETP.available}),this.avatars.forEach(t=>{t.address===e&&n.pop()}))}),this.addressbalances=n}),this.defaultFee=this.fee,this.metaverseService.getFees().then(e=>{this.fee=e.mitIssue,this.defaultFee=this.fee})}ngOnInit(){}create(){return this.alertService.showLoading().then(()=>this.metaverseService.createRegisterMITTx(this.recipient_address,this.recipient_avatar,this.symbol,this.content,void 0,this.showAdvanced?this.fee:this.defaultFee)).catch(e=>{switch(console.error(e),this.alertService.stopLoading(),e.message){case"ERR_CONNECTION":this.alertService.showError("SEND.MESSAGE.ERROR_SEND_TEXT","");break;case"ERR_BROADCAST":this.translate.get("SEND.MESSAGE.ONE_TX_PER_BLOCK").subscribe(e=>{this.alertService.showError("SEND.MESSAGE.BROADCAST_ERROR",e)});break;case"ERR_INSUFFICIENT_BALANCE":this.alertService.showError("SEND.MESSAGE.INSUFFICIENT_BALANCE","");break;default:this.alertService.showError("SEND.MESSAGE.CREATE_TRANSACTION",e.message)}})}send(){this.create().then(e=>{const t=e.encode().toString("hex");this.router.navigate(["account","confirm"],{state:{data:{tx:t}}}),this.alertService.stopLoading()})}}return e.\u0275fac=function(t){return new(t||e)(r.Rb(l.a),r.Rb(o.eb),r.Rb(s.h),r.Rb(c.e),r.Rb(b.a))},e.\u0275cmp=r.Lb({type:e,selectors:[["app-create"]],decls:44,vars:29,consts:[["slot","start"],["defaultHref","/account/mit"],["translate","CREATE_MIT.TITLE"],["align","center","translate","CREATE_MIT.INFORMATION"],["translate","CREATE_MIT.FEE_WARNING",1,"right",3,"translateParams"],[3,"ngSubmit"],["sendForm","ngForm"],[3,"ngClass"],["color","primary","position","floating","translate","CREATE_MIT.SYMBOL"],["name","symbol","maxlength","63","required","",3,"ngModel","ngModelChange"],["lines","none","class","wrong-input","translate","CREATE_MIT.MIT_ALREADY_EXIST",4,"ngIf"],["lines","none","class","wrong-input","translate","CREATE_MIT.MIT_SYMBOL_TOO_SHORT",4,"ngIf"],["color","primary","position","floating","translate","CREATE_MIT.CONTENT"],["name","content","maxlength","252",3,"ngModel","ngModelChange"],["color","primary","position","floating","translate","CREATE_MIT.AVATAR_NAME"],["name","recipient_avatar","multiple","false",3,"ngModel","okText","cancelText","ngModelChange",4,"ngIf"],["name","no_avatar","disabled","",3,"ngModel","ngModelChange",4,"ngIf"],["lines","none","class","wrong-input","translate","CREATE_MIT.NO_AVATAR",4,"ngIf"],["color","primary","position","floating","translate","CREATE_MIT.RECIPIENT_ADDRESS"],["name","recipient_address","disabled","",3,"ngModel","ngModelChange"],[1,"toggle-input"],["translate","CREATE_MIT.SHOW_ADVANCED"],["name","showAdvanced","checked","false",3,"ngModel","ngModelChange"],[4,"ngIf"],[1,"padding-bottom"],["color","danger","fill","outline","shape","round","expand","full","routerLink","/account/mit"],["slot","start","name","close"],["translate","CREATE_MIT.BUTTON.CANCEL"],["expand","full","type","submit","fill","outline","shape","round","color","primary",3,"disabled"],["slot","start","disabled","checked","name","cog"],["translate","CREATE_MIT.BUTTON.NEXT"],["lines","none","translate","CREATE_MIT.MIT_ALREADY_EXIST",1,"wrong-input"],["lines","none","translate","CREATE_MIT.MIT_SYMBOL_TOO_SHORT",1,"wrong-input"],["name","recipient_avatar","multiple","false",3,"ngModel","okText","cancelText","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["name","no_avatar","disabled","",3,"ngModel","ngModelChange"],["lines","none","translate","CREATE_MIT.NO_AVATAR",1,"wrong-input"],["lines","none"],["color","primary","translate","CREATE_MIT.FEE"],["item-end","","color","primary"],["min","10000","max","10000000","step","10000","color","primary","name","fee",3,"ngModel","ngModelChange"],["range-left",""],["range-right",""]],template:function(e,t){if(1&e&&(r.Xb(0,"ion-header"),r.Xb(1,"ion-toolbar"),r.Xb(2,"ion-buttons",0),r.Sb(3,"ion-back-button",1),r.Wb(),r.Sb(4,"ion-title",2),r.Wb(),r.Wb(),r.Xb(5,"ion-content"),r.Xb(6,"ion-row"),r.Xb(7,"ion-col"),r.Sb(8,"p",3),r.Wb(),r.Wb(),r.Xb(9,"ion-row"),r.Sb(10,"ion-col",4),r.kc(11,"format"),r.Wb(),r.Xb(12,"form",5,6),r.fc("ngSubmit",(function(){return t.send()})),r.Xb(14,"ion-list"),r.Xb(15,"ion-item",7),r.Sb(16,"ion-label",8),r.Xb(17,"ion-input",9),r.fc("ngModelChange",(function(e){return t.symbol=e}))("ngModelChange",(function(){return t.symbolChanged()})),r.Wb(),r.Wb(),r.Gc(18,h,1,0,"ion-item",10),r.Gc(19,g,1,0,"ion-item",11),r.Xb(20,"ion-item",7),r.Sb(21,"ion-label",12),r.Xb(22,"ion-input",13),r.fc("ngModelChange",(function(e){return t.content=e})),r.Wb(),r.Wb(),r.Xb(23,"ion-item",7),r.Sb(24,"ion-label",14),r.Gc(25,f,4,8,"ion-select",15),r.Gc(26,p,1,1,"ion-input",16),r.Wb(),r.Gc(27,u,1,0,"ion-item",17),r.Xb(28,"ion-item",7),r.Sb(29,"ion-label",18),r.Xb(30,"ion-input",19),r.fc("ngModelChange",(function(e){return t.recipient_address=e})),r.Wb(),r.Wb(),r.Xb(31,"ion-item",20),r.Sb(32,"ion-label",21),r.Xb(33,"ion-toggle",22),r.fc("ngModelChange",(function(e){return t.showAdvanced=e})),r.Wb(),r.Wb(),r.Gc(34,E,14,13,"div",23),r.Wb(),r.Xb(35,"ion-row",24),r.Xb(36,"ion-col"),r.Xb(37,"ion-button",25),r.Sb(38,"ion-icon",26),r.Sb(39,"span",27),r.Wb(),r.Wb(),r.Xb(40,"ion-col"),r.Xb(41,"ion-button",28),r.Sb(42,"ion-icon",29),r.Sb(43,"span",30),r.Wb(),r.Wb(),r.Wb(),r.Wb(),r.Wb()),2&e){const e=r.yc(13);r.Fb(10),r.pc("translateParams",r.tc(19,v,r.mc(11,16,t.fee,8))),r.Fb(5),r.pc("ngClass",r.tc(21,_,!t.validSymbol(t.symbol))),r.Fb(2),r.pc("ngModel",t.symbol),r.Fb(1),r.pc("ngIf",t.symbol.length>=3&&!t.symbol_available),r.Fb(1),r.pc("ngIf",t.symbol.length>0&&t.symbol.length<3),r.Fb(1),r.pc("ngClass",r.tc(23,_,!t.validContent(t.content))),r.Fb(2),r.pc("ngModel",t.content),r.Fb(1),r.pc("ngClass",r.tc(25,_,!t.validName(t.recipient_avatar))),r.Fb(2),r.pc("ngIf",!t.no_avatar),r.Fb(1),r.pc("ngIf",t.no_avatar),r.Fb(1),r.pc("ngIf",t.no_avatar),r.Fb(1),r.pc("ngClass",r.tc(27,_,!t.validAddress(t.recipient_address))),r.Fb(2),r.pc("ngModel",t.recipient_address),r.Fb(3),r.pc("ngModel",t.showAdvanced),r.Fb(1),r.pc("ngIf",t.showAdvanced),r.Fb(7),r.pc("disabled",!(e.form.valid&&t.validSymbol(t.symbol)&&t.validContent(t.content)&&t.validName(t.recipient_avatar)&&t.validAddress(t.recipient_address)))}},directives:[o.u,o.X,o.j,o.f,o.g,o.V,c.a,o.r,o.K,o.q,i.p,i.j,i.k,o.A,o.x,a.k,o.z,o.w,o.hb,i.f,i.n,i.i,i.l,a.m,o.W,o.c,o.i,o.fb,s.i,o.v,o.N,o.gb,a.l,o.O,o.h,o.G],pipes:[d.a,c.d],styles:[""]}),e})()}];let A=(()=>{class e{}return e.\u0275mod=r.Pb({type:e}),e.\u0275inj=r.Ob({factory:function(t){return new(t||e)},imports:[[s.j.forChild(T)],s.j]}),e})();var C=n("iTUp");let M=(()=>{class e{}return e.\u0275mod=r.Pb({type:e}),e.\u0275inj=r.Ob({factory:function(t){return new(t||e)},imports:[[a.c,i.e,o.Y,c.c.forChild(),C.a,A]]}),e})()},q5gJ:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n("fXoL");let i=(()=>{class e{transform(e,t){return(e/Math.pow(10,t)).toLocaleString(void 0,{maximumFractionDigits:t})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=a.Qb({name:"format",type:e,pure:!0}),e})()}}]);