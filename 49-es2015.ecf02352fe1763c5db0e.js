(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{dwd6:function(t,i,e){"use strict";e.r(i),e.d(i,"LoadingPageModule",(function(){return _}));var s=e("ofXK"),n=e("3Pt+"),a=e("TEn/"),r=e("tyNb"),o=e("mrSG"),c=e("lJxs"),l=e("7o/Q"),h=e("D0XW");e("l7GE"),e("ZUHj");const u={leading:!0,trailing:!1};class d{constructor(t,i,e,s){this.duration=t,this.scheduler=i,this.leading=e,this.trailing=s}call(t,i){return i.subscribe(new g(t,this.duration,this.scheduler,this.leading,this.trailing))}}class g extends l.a{constructor(t,i,e,s,n){super(t),this.duration=i,this.scheduler=e,this.leading=s,this.trailing=n,this._hasTrailingValue=!1,this._trailingValue=null}_next(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(b,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))}_complete(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()}clearThrottle(){const t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)}}function b(t){const{subscriber:i}=t;i.clearThrottle()}var p=e("fXoL"),f=e("BZA/"),m=e("sYmb"),v=e("OaWH");function O(t,i){1&t&&p.Sb(0,"div",13)}const T=function(t){return{height:t}};function w(t,i){if(1&t&&(p.Sb(0,"h4",14),p.kc(1,"async")),2&t){const t=p.jc();p.pc("translateParams",p.tc(3,T,p.lc(1,1,t.metaverseService.lastTxHeight$)))}}function S(t,i){1&t&&p.Sb(0,"h4",15)}function y(t,i){1&t&&p.Sb(0,"p",16)}function I(t,i){if(1&t){const t=p.Yb();p.Xb(0,"ion-row",17),p.Xb(1,"ion-col"),p.Xb(2,"ion-button",18),p.fc("click",(function(){return p.Ac(t),p.jc().cancel()})),p.Sb(3,"ion-icon",19),p.Sb(4,"span",20),p.Wb(),p.Wb(),p.Xb(5,"ion-col"),p.Xb(6,"ion-button",21),p.fc("click",(function(){return p.Ac(t),p.jc().updateBalances()})),p.Sb(7,"ion-icon",22),p.Sb(8,"span",23),p.Wb(),p.Wb(),p.Wb()}}const x=[{path:"",component:(()=>{class t{constructor(t,i,e,s,n){this.metaverseService=t,this.translate=i,this.platform=e,this.appService=s,this.router=n,this.loadingHeight=0,this.reset=!1,this.showRestartOption=!1,this.progress$=this.metaverseService.lastTxHeight$.pipe(Object(c.a)(t=>this.calcProgress(t,this.maxHeight,this.firstTxHeight)),function(t,i=h.a,e=u){return s=>s.lift(new d(t,i,e.leading,e.trailing))}(300)),this.reset=history.state.data&&history.state.data.reset}ngOnInit(){return Object(o.a)(this,void 0,void 0,(function*(){(this.reset||(yield this.metaverseService.getDbUpdateNeeded()))&&(yield this.metaverseService.dataReset(),yield this.metaverseService.setDbVersion(this.appService.db_version)),yield this.updateBalances()}))}ngOnDestroy(){this.lastTxHeightSubscription&&this.lastTxHeightSubscription.unsubscribe()}updateBalances(){return Object(o.a)(this,void 0,void 0,(function*(){this.showRestartOption=!1;try{this.maxHeight=yield this.metaverseService.updateHeight(),yield this.metaverseService.getData(),yield this.metaverseService.setUpdateTime(),setTimeout(()=>this.router.navigate(["/account","portfolio"],{replaceUrl:!0}),1e3)}catch(t){switch(console.error(t),t.message){case"ERR_NO_ADDRESS":this.router.navigate(["login"]);break;default:this.showRestartOption=!0}}}))}calcProgress(t,i,e=0){return t&&i?Math.max(1,Math.min(99,Math.round((t-e)/(i-e)*100))):0}cancel(){return Object(o.a)(this,void 0,void 0,(function*(){yield this.metaverseService.hardReset(),this.router.navigate(["/"])}))}}return t.\u0275fac=function(i){return new(i||t)(p.Rb(f.a),p.Rb(m.e),p.Rb(a.eb),p.Rb(v.a),p.Rb(r.h))},t.\u0275cmp=p.Lb({type:t,selectors:[["app-loading"]],decls:21,vars:15,consts:[[1,"center"],["size-md","12","size-lg","6","offset-lg","3"],[1,"top-message"],["translate","LOADING.TITLE"],[1,"logo-row"],[1,"logo"],[1,"banner"],["class","mini-loader",4,"ngIf"],["color","primary",3,"value"],["translate","LOADING.CURRENT_HEIGHT",3,"translateParams",4,"ngIf"],["class","valid-input","translate","LOADING.COMPLETE",4,"ngIf"],["class","wrong-input","translate","LOADING.STOPPED",4,"ngIf"],["class","padding-bottom",4,"ngIf"],[1,"mini-loader"],["translate","LOADING.CURRENT_HEIGHT",3,"translateParams"],["translate","LOADING.COMPLETE",1,"valid-input"],["translate","LOADING.STOPPED",1,"wrong-input"],[1,"padding-bottom"],["color","danger","fill","outline","shape","round",3,"click"],["slot","start","name","close"],["translate","LOADING.BUTTON.BACK"],["type","submit","fill","outline","shape","round","color","primary",3,"click"],["slot","start","name","sync"],["translate","LOADING.BUTTON.RETRY"]],template:function(t,i){1&t&&(p.Xb(0,"ion-content",0),p.Xb(1,"ion-grid"),p.Xb(2,"ion-row"),p.Xb(3,"ion-col",1),p.Xb(4,"ion-row",2),p.Xb(5,"ion-col"),p.Sb(6,"h1",3),p.Wb(),p.Wb(),p.Xb(7,"ion-row",4),p.Xb(8,"ion-col",5),p.Sb(9,"div",6),p.Wb(),p.Wb(),p.Gc(10,O,1,0,"div",7),p.Ic(11),p.kc(12,"async"),p.Sb(13,"ion-progress-bar",8),p.kc(14,"async"),p.Gc(15,w,2,5,"h4",9),p.kc(16,"async"),p.Gc(17,S,1,0,"h4",10),p.kc(18,"async"),p.Gc(19,y,1,0,"p",11),p.Gc(20,I,9,0,"ion-row",12),p.Wb(),p.Wb(),p.Wb(),p.Wb()),2&t&&(p.Fb(10),p.pc("ngIf",!i.showRestartOption),p.Fb(1),p.Kc(" ",p.lc(12,7,i.progress$),"% "),p.Fb(2),p.pc("value",p.lc(14,9,i.progress$)/100),p.Fb(2),p.pc("ngIf",100!=p.lc(16,11,i.progress$)),p.Fb(2),p.pc("ngIf",100==p.lc(18,13,i.progress$)),p.Fb(2),p.pc("ngIf",i.showRestartOption),p.Fb(1),p.pc("ngIf",i.showRestartOption))},directives:[a.r,a.t,a.K,a.q,m.a,s.m,a.F,a.i,a.v],pipes:[s.b],styles:[".logo-row[_ngcontent-%COMP%]{min-height:120px;padding-top:50px;padding-bottom:20px}.logo[_ngcontent-%COMP%]{padding-left:20px;padding-right:20px}.banner[_ngcontent-%COMP%]{margin:10px auto;background:url(/assets/logo.png) no-repeat;width:100%;max-width:240px;height:100px;outline:0;background-size:100%}"]}),t})()}];let R=(()=>{class t{}return t.\u0275mod=p.Pb({type:t}),t.\u0275inj=p.Ob({factory:function(i){return new(i||t)},imports:[[r.j.forChild(x)],r.j]}),t})(),_=(()=>{class t{}return t.\u0275mod=p.Pb({type:t}),t.\u0275inj=p.Ob({factory:function(i){return new(i||t)},imports:[[s.c,n.e,m.c.forChild(),a.Y,R]]}),t})()}}]);