(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{"26X8":function(t,e,o){"use strict";o.r(e),o.d(e,"PassphrasePageModule",(function(){return L}));var i=o("ofXK"),n=o("3Pt+"),r=o("TEn/"),s=o("tyNb"),a=o("mrSG"),c=o("fXoL"),l=o("OaWH"),b=o("sYmb"),d=o("vZMD"),p=o("BZA/"),f=o("Fvwb"),S=o("3LUQ");function u(t,e){1&t&&c.Sb(0,"ion-label",14)}function m(t,e){if(1&t&&(c.Xb(0,"ion-label",15),c.Ic(1),c.kc(2,"translate"),c.kc(3,"uppercase"),c.Wb()),2&t){const t=c.jc(2);c.Fb(1),c.Kc(" ",c.mc(2,1,c.lc(3,4,"SELECT_PASSPHRASE.ERROR."+t.getError(t.form.controls.passphrase)[0]),t.getError(t.form.controls.passphrase)[1])," ")}}function h(t,e){1&t&&c.Sb(0,"ion-label",16)}function E(t,e){if(1&t&&(c.Xb(0,"ion-label",15),c.Ic(1),c.kc(2,"translate"),c.kc(3,"uppercase"),c.Wb()),2&t){const t=c.jc(2);c.Fb(1),c.Kc(" ",c.lc(2,1,c.lc(3,3,"SELECT_PASSPHRASE.ERROR."+t.getError(t.form.controls.repeat,t.form)[0]))," ")}}function g(t,e){if(1&t&&(c.Xb(0,"ion-button",17),c.Sb(1,"ion-icon",18),c.Sb(2,"span",19),c.Wb()),2&t){const t=c.jc(2);c.pc("disabled",!t.form.valid)}}function A(t,e){if(1&t){const t=c.Yb();c.Xb(0,"form",7),c.fc("ngSubmit",(function(){return c.Ac(t),c.jc().downloadAndReturnLogin()})),c.Xb(1,"ion-item"),c.Gc(2,u,1,0,"ion-label",8),c.Gc(3,m,4,6,"ion-label",9),c.Sb(4,"ion-input",10),c.Wb(),c.Xb(5,"ion-item"),c.Gc(6,h,1,0,"ion-label",11),c.Gc(7,E,4,5,"ion-label",9),c.Sb(8,"ion-input",12),c.Wb(),c.Gc(9,g,3,1,"ion-button",13),c.Wb()}if(2&t){const t=c.jc();c.pc("formGroup",t.form),c.Fb(2),c.pc("ngIf",!t.getError(t.form.controls.passphrase)),c.Fb(1),c.pc("ngIf",t.getError(t.form.controls.passphrase)),c.Fb(3),c.pc("ngIf",!t.getError(t.form.controls.repeat,t.form)),c.Fb(1),c.pc("ngIf",t.getError(t.form.controls.repeat,t.form)),c.Fb(2),c.pc("ngIf",!t.isMobile)}}function v(t,e){if(1&t){const t=c.Yb();c.Xb(0,"ion-row"),c.Xb(1,"ion-col",20),c.Xb(2,"ion-button",21),c.fc("click",(function(){return c.Ac(t),c.jc(2).download()})),c.Sb(3,"ion-icon",18),c.Sb(4,"span",19),c.Wb(),c.Wb(),c.Xb(5,"ion-col",20),c.Xb(6,"ion-button",22),c.fc("click",(function(){return c.Ac(t),c.jc(2).encrypt()})),c.Sb(7,"ion-icon",23),c.Sb(8,"span",24),c.Wb(),c.Wb(),c.Wb()}if(2&t){const t=c.jc(2);c.Fb(2),c.pc("disabled",!t.form.valid),c.Fb(4),c.pc("disabled",!t.form.valid)}}function w(t,e){if(1&t){const t=c.Yb();c.Xb(0,"ion-row"),c.Xb(1,"ion-col",25),c.Xb(2,"ion-button",22),c.fc("click",(function(){return c.Ac(t),c.jc(2).encrypt()})),c.Sb(3,"ion-icon",23),c.Sb(4,"span",24),c.Wb(),c.Wb(),c.Wb()}if(2&t){const t=c.jc(2);c.Fb(2),c.pc("disabled",!t.form.valid)}}function R(t,e){if(1&t&&(c.Xb(0,"ion-footer"),c.Gc(1,v,9,2,"ion-row",6),c.Gc(2,w,5,1,"ion-row",6),c.Wb()),2&t){const t=c.jc();c.Fb(1),c.pc("ngIf",!t.isApp),c.Fb(1),c.pc("ngIf",t.isApp)}}const y=[{path:"",component:(()=>{class t{constructor(t,e,o,i,n,r,s,a,c,l){this.globals=t,this.translate=e,this.crypto=o,this.platform=i,this.metaverseService=n,this.loadingCtrl=r,this.walletService=s,this.formBuilder=a,this.router=c,this.alertService=l,this.mnemonic=history.state.data&&history.state.data.mnemonic?history.state.data.mnemonic:"",this.passwordValid=t=>!!t&&t.length>5,this.passwordRepeatValid=(t,e)=>!!e&&e.length>5&&e===t,this.complete=(t,e)=>!(!t||!e)&&this.passwordValid(t)&&t===e}ngOnInit(){this.isMobile=this.walletService.isMobile(),this.isApp=this.walletService.isApp();const t=new n.b("",[n.o.required,n.o.minLength(8)]),e=new n.b("",[n.o.required]);this.form=this.formBuilder.group({passphrase:t,repeat:e},{validators:[this.isSame(t,e)]})}isSame(t,e){return()=>e.value===t.value?null:{notSame:!0}}getError(t,e){if(!t.pristine)return t.errors?Object.entries(t.errors)[0]:void 0!==e&&e.errors?Object.entries(e.errors)[0]:void 0}downloadAndReturnLogin(){return Object(a.a)(this,void 0,void 0,(function*(){yield this.download(),this.router.navigate(["/"]),this.alertService.showMessage("LOGIN.FILE_BACK_LOGIN_ALERT.TITLE","LOGIN.FILE_BACK_LOGIN_ALERT.SUBTITLE","","LOGIN.FILE_BACK_LOGIN_ALERT.OK")}))}download(){return Object(a.a)(this,void 0,void 0,(function*(){const t=this.form.value.passphrase;try{const e=yield this.crypto.encrypt(this.mnemonic,t),o=yield this.dataToKeystoreJson(e);this.downloadFile("mvs_keystore.json",JSON.stringify(o))}catch(e){console.log(e)}}))}encrypt(){return Object(a.a)(this,void 0,void 0,(function*(){const t=this.form.value.passphrase;try{const e=yield this.walletService.setSeedMobile(t,this.mnemonic);yield this.walletService.setMobileWallet(e);const o=yield this.walletService.getWallet(t),i=yield this.walletService.generateAddresses(o,0,this.globals.index);yield this.metaverseService.setAddresses(i),yield this.walletService.setVmAddressFromPassphrase(t);const n=yield this.walletService.getMasterPublicKey(t);yield this.walletService.setXpub(n),yield this.walletService.saveSessionAccount(t),this.router.navigate(["/loading"],{state:{data:{reset:!0}}})}catch(e){switch(console.error(e),e){case"illegal mnemonic":this.alertService.showError("SELECT_PASSPHRASE.MESSAGE.ERROR_MNEMONIC","");break;default:this.alertService.showError("SELECT_PASSPHRASE.MESSAGE.ERROR",e.message)}}}))}downloadFile(t,e){const o=document.createElement("a");if(o.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),o.setAttribute("download",t),document.createEvent){const t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),o.dispatchEvent(t)}else o.click()}dataToKeystoreJson(t){return{version:this.globals.version,algo:this.globals.algo,index:this.globals.index,mnemonic:t}}}return t.\u0275fac=function(e){return new(e||t)(c.Rb(l.a),c.Rb(b.e),c.Rb(d.a),c.Rb(r.eb),c.Rb(p.a),c.Rb(r.ab),c.Rb(f.a),c.Rb(n.a),c.Rb(s.h),c.Rb(S.a))},t.\u0275cmp=c.Lb({type:t,selectors:[["app-passphrase"]],decls:12,vars:2,consts:[["slot","start"],["defaultHref","/login"],["translate","SELECT_PASSPHRASE.TITLE"],["size-md","12","size-lg","6","offset-lg","3"],["translate","SELECT_PASSPHRASE.TEXT",1,"center-info"],[3,"formGroup","ngSubmit",4,"ngIf"],[4,"ngIf"],[3,"formGroup","ngSubmit"],["position","floating","translate","SELECT_PASSPHRASE.PASSWORD","color","primary",4,"ngIf"],["position","floating","color","danger",4,"ngIf"],["formControlName","passphrase","type","password","clearOnEdit","false"],["position","floating","translate","SELECT_PASSPHRASE.CONFIRM_PASSWORD","color","primary",4,"ngIf"],["formControlName","repeat","type","password","clearOnEdit","false"],["type","submit","expand","full","fill","outline","shape","round",3,"disabled",4,"ngIf"],["position","floating","translate","SELECT_PASSPHRASE.PASSWORD","color","primary"],["position","floating","color","danger"],["position","floating","translate","SELECT_PASSPHRASE.CONFIRM_PASSWORD","color","primary"],["type","submit","expand","full","fill","outline","shape","round",3,"disabled"],["slot","start","name","download"],["translate","SELECT_PASSPHRASE.BUTTON.DOWNLOAD_FILE"],["size","6"],["color","secondary","type","submit","expand","full",3,"disabled","click"],["type","submit","expand","full",3,"disabled","click"],["slot","start","name","arrow-forward"],["translate","SELECT_PASSPHRASE.BUTTON.ENTER"],["size","12"]],template:function(t,e){1&t&&(c.Xb(0,"ion-header"),c.Xb(1,"ion-toolbar"),c.Xb(2,"ion-buttons",0),c.Sb(3,"ion-back-button",1),c.Wb(),c.Sb(4,"ion-title",2),c.Wb(),c.Wb(),c.Xb(5,"ion-content"),c.Xb(6,"ion-grid"),c.Xb(7,"ion-row"),c.Xb(8,"ion-col",3),c.Sb(9,"p",4),c.Gc(10,A,10,6,"form",5),c.Wb(),c.Wb(),c.Wb(),c.Wb(),c.Gc(11,R,3,2,"ion-footer",6)),2&t&&(c.Fb(10),c.pc("ngIf",e.form),c.Fb(1),c.pc("ngIf",e.isMobile))},directives:[r.u,r.X,r.j,r.f,r.g,r.V,b.a,r.r,r.t,r.K,r.q,i.m,n.p,n.j,n.d,r.x,r.w,r.hb,n.i,n.c,r.z,r.i,r.v,r.s],pipes:[b.d,i.q],styles:[""]}),t})()}];let I=(()=>{class t{}return t.\u0275mod=c.Pb({type:t}),t.\u0275inj=c.Ob({factory:function(e){return new(e||t)},imports:[[s.j.forChild(y)],s.j]}),t})(),L=(()=>{class t{}return t.\u0275mod=c.Pb({type:t}),t.\u0275inj=c.Ob({factory:function(e){return new(e||t)},imports:[[i.c,n.e,r.Y,n.m,b.c.forChild(),I]]}),t})()}}]);